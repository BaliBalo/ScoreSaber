!async function(){document.body.classList.add("js-loaded");const e=200,t=100,n=.965,a="PAUSE_UPDATE",i=[{at:0,value:0},{at:.6,value:.18223233667439062},{at:.65,value:.5866010012767576},{at:.7,value:.6125565959114954},{at:.75,value:.6451808210101443},{at:.8,value:.6872268862950283},{at:.825,value:.7150465663454271},{at:.85,value:.7462290664143185},{at:.875,value:.7816934560296046},{at:.9,value:.825756123560842},{at:.91,value:.8488375988124467},{at:.92,value:.8728710341448851},{at:.93,value:.9039994071865736},{at:.94,value:.9417362980580238},{at:.95,value:1},{at:.955,value:1.0388633331418984},{at:.96,value:1.0871883573850478},{at:.965,value:1.1552120359501035},{at:.97,value:1.2485807759957321},{at:.9725,value:1.3090333065057616},{at:.975,value:1.3807102743105126},{at:.9775,value:1.4664726399289512},{at:.98,value:1.5702410055532239},{at:.9825,value:1.697536248647543},{at:.985,value:1.8563887693647105},{at:.9875,value:2.058947159052738},{at:.99,value:2.324506282149922},{at:.99125,value:2.4902905794106913},{at:.9925,value:2.685667856592722},{at:.99375,value:2.9190155639254955},{at:.995,value:3.2022017597337955},{at:.99625,value:3.5526145337555373},{at:.9975,value:3.996793606763322},{at:.99825,value:4.325027383589547},{at:.999,value:4.715470646416203},{at:.9995,value:5.019543595874787},{at:1,value:5.367394282890631}],s={ExpertPlus:{className:"expert-plus",display:"Expert+"}},l=[{type:1,name:"Accuracy",slug:"accuracy"},{type:1,name:"Balanced",slug:"balanced"},{type:1,name:"Challenge",slug:"challenge"},{type:1,name:"Dance",slug:"dance-style"},{type:1,name:"Fitness",slug:"fitness"},{type:1,name:"Speed",slug:"speed"},{type:1,name:"Tech",slug:"tech"},{type:2,name:"Alternative",slug:"alternative"},{type:2,name:"Ambient",slug:"ambient"},{type:2,name:"Anime",slug:"anime"},{type:2,name:"Classical & Orchestral",slug:"classical-orchestral"},{type:2,name:"Comedy & Meme",slug:"comedy-meme"},{type:2,name:"Dance",slug:"dance"},{type:2,name:"Drum and Bass",slug:"drum-and-bass"},{type:2,name:"Dubstep",slug:"dubstep"},{type:2,name:"Electronic",slug:"electronic"},{type:2,name:"Folk & Acoustic",slug:"folk-acoustic"},{type:2,name:"Funk & Disco",slug:"funk-disco"},{type:2,name:"Hardcore",slug:"hardcore"},{type:2,name:"Hip Hop & Rap",slug:"hip-hop-rap"},{type:2,name:"Holiday",slug:"holiday"},{type:2,name:"House",slug:"house"},{type:2,name:"Indie",slug:"indie"},{type:2,name:"Instrumental",slug:"instrumental"},{type:2,name:"J-Pop",slug:"j-pop"},{type:2,name:"J-Rock",slug:"j-rock"},{type:2,name:"Jazz",slug:"jazz"},{type:2,name:"K-Pop",slug:"k-pop"},{type:2,name:"Kids & Family",slug:"kids-family"},{type:2,name:"Metal",slug:"metal"},{type:2,name:"Nightcore",slug:"nightcore"},{type:2,name:"Pop",slug:"pop"},{type:2,name:"Punk",slug:"punk"},{type:2,name:"R&B",slug:"rb"},{type:2,name:"Rock",slug:"rock"},{type:2,name:"Soul",slug:"soul"},{type:2,name:"Speedcore",slug:"speedcore"},{type:2,name:"Swing",slug:"swing"},{type:2,name:"Techno",slug:"techno"},{type:2,name:"Trance",slug:"trance"},{type:2,name:"TV & Film",slug:"tv-movie-soundtrack"},{type:2,name:"Video Game",slug:"video-game-soundtrack"},{type:2,name:"Vocaloid",slug:"vocaloid"}];function o(e,t){e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}function r(e,t=0){return e.toFixed(t).replace(/\.?0*$/,"")}function c(e,t,n){return e<t?t:e>n?n:e}function d(e,t,n){return t+e*(n-t)}function u(e,t,n){return c((e-t)/(n-t),0,1)}function p(e){return("0"+e).slice(-2)}function h(e,t){let n=e.getFullYear()+"-"+p(e.getMonth()+1)+"-"+p(e.getDate()),a=p(e.getHours())+":"+p(e.getMinutes());return t&&(a+=":"+p(e.getSeconds())),n+" "+a}const m=function(){const e=6e4,t=36e5,n=24*t;let a=(e,t)=>~~(e/t),i=(e,t)=>e+" "+t+(1!==e&&-1!==e?"s":"");return s=>function(s,l){let o=l-s,r=Math.abs(o);if(r<e)return i(a(o,1e3),"second");if(r<t)return i(a(o,e),"minute");if(r<n)return i(a(o,t),"hour");if(r<2592e6)return i(a(o,n),"day");let c=function(e,t){let n=t.getFullYear()-e.getFullYear();return t.getMonth()-e.getMonth()+12*n}(s,l);return Math.abs(c)<12?i(c,"month"):i(~~(c/12),"year")}(s,new Date)+" ago"}();function g(e,t,n,a){let i=document.createElement(e);return null!=t&&(i.className=t),null!=n&&(Array.isArray(n)?i.append(...n):i.append(n)),null!=a&&(i.title=a),i}let f=g.bind(null,"div"),y=g.bind(null,"span"),v=(e,t,n)=>{let a=g("input",e);return t&&(a.value=t),n&&(a.placeholder=n),a},b=(e,t)=>{let n=g("option","",e);return n.value=t,n},w=(e,t,n,a,i)=>{let s=g("a",t,n,a);return s.href=e,i&&(s.target=i),s};async function C(e){await new Promise((t=>setTimeout(t,e)))}async function A(...e){return(await fetch(...e)).json()}async function k(e,t){let n="";if(t){n="?"+new URLSearchParams(t).toString()}return await A("/scoresaber-api"+e+n)}async function S(e){let t=await k("/player/"+e+"/full");return{id:t.id,name:t.name,avatar:t.profilePicture,country:t.country,rank:t.rank,pp:t.pp,rankedPlays:t.scoreStats?.rankedPlayCount||"??"}}async function I(e,n,a="top",i){return(await k("/player/"+e+"/scores",{sort:a,limit:i||t,page:+n||1})).playerScores.map((({score:e,leaderboard:t})=>({uid:t.id,rank:e.rank,at:+new Date(e.timeSet),userPP:e.pp,weighted:e.pp*e.weight,maxScore:t.maxScore,score:e.baseScore/t.maxScore,modScore:e.modifiedScore/t.maxScore})))}async function x(e){let t;e&&(t={headers:{"If-Modified-Since":e.toUTCString()}});let n=await A("/ranked",t);return function(e){X=e.timestamp;let t=new Date(X);ce.textContent=m(t)+" ("+h(t,!0)+")",ce.title=t.toString(),ce.classList.remove("unknown")}(n),n}async function E(e,t,n=2){if(!e?.uid||!t)return console.log("Invalid score at rank request",e,t),0;let a=Math.ceil(t/12),i=t-12*(a-1)-1;try{let t=await async function(e,t){return((await k("/leaderboard/by-id/"+e+"/scores",{page:+t||1})).scores||[]).map((e=>({rank:e.rank,at:+new Date(e.timeSet),userPP:e.pp,weighted:e.pp*e.weight,scoreRaw:e.baseScore,modScoreRaw:e.modifiedScore})))}(e?.uid,a);return(t[i]?.scoreRaw||0)/e.maxScore}catch(a){return n-- >0?(await C(1e3),E(e,t,n)):(console.log("Error getting score at rank",a),0)}}async function L(e,t=2){if(!e)return console.log("Invalid player at rank request",e),null;let n=Math.ceil(e/50),a=e-50*(n-1)-1;try{let e=await async function(e){return(await k("/players",{page:+e||1})).players.map((e=>({id:e.id,name:e.name,rank:e.rank,pp:e.pp,country:e.country})))}(n);return e[a]?.id}catch(n){return t-- >0?(await C(1e3),L(e,t)):(console.log("Error getting player at rank",n),null)}}function P(e,t){if(!t.length||"number"!=typeof e||Number.isNaN(e))return 0;let n=t.findIndex((t=>t.at>=e));if(-1===n)return t[t.length-1].value;if(!n)return t[0].value;let a=t[n-1],i=t[n],s=(e-a.at)/(i.at-a.at);return a.value+(i.value-a.value)*s}try{WebFont.load({custom:{families:["NeonTubes"]}})}catch(e){}let T=document.getElementById("user"),O=document.getElementById("profile"),M=document.getElementById("user-fetch-info"),D=[];try{let e=JSON.parse(localStorage.getItem("history"));Array.isArray(e)&&(D=e)}catch(e){}let F=document.querySelector(".history");function N(){F.innerHTML="",D.slice(0,5).forEach((e=>{if(!e||!e.avatar||null==e.rank||null==e.name)return;let t=g("button","line");t.addEventListener("click",(()=>{O.disabled||(O.value=e.id,Ae())}));let n=f("avatar");n.style.backgroundImage="url("+e.avatar+")",t.appendChild(n),t.appendChild(f("rank",e.rank.toLocaleString())),t.appendChild(f("name",e.name)),F.appendChild(t)}))}function B(e){D=D.filter((t=>t&&t.id!==e.id)),D.unshift(e),D=D.slice(0,5);try{localStorage.setItem("history",JSON.stringify(D))}catch(e){}N()}N();let U={};async function H(e){U=e;try{localStorage.setItem("peepee-filters",function(e){return JSON.stringify({...e,tags:e.tags.map((e=>e?.slug)).filter((e=>e))},((e,t)=>"number"==typeof t&&Math.abs(t)===1/0?t+"":t))}(e))}catch(e){}Ce.refresh(),we.refresh()}function R(e){let t=y(),n=getComputedStyle(e);Object.assign(t.style,{position:"absolute",top:"-99px",left:"-99px",height:"0",whiteSpace:"pre",overflow:"hidden",visibility:"hidden",font:n.font,letterSpacing:n.letterSpacing,padding:n.padding});let a=()=>{t.textContent=e.value||e.placeholder||" ",e.style.width=t.clientWidth+1+"px"};return document.body.appendChild(t),e.addEventListener("input",a),a(),{check:a,stop:()=>{e.removeEventListener("input",a),document.body.removeChild(t)}}}function K(e){const{overflow:t,overflowX:n,overflowY:a,display:i}=getComputedStyle(e);return/auto|scroll|overlay|hidden|clip/.test(t+a+n)&&!["inline","contents"].includes(i)}function j(e=[]){let t=e.slice(),n=y("selection-wrapper"),a=v(null,"","Select a tag...");a.id="tag-selector-input";let i=R(a),s=g("label","tag-selector",[n,a]);s.htmlFor=a.id,s.tabIndex=-1;let o=f("tag-selector-suggestions");o.tabIndex=0,o.addEventListener("focus",(()=>o.firstElementChild?.focus()));let r,c=()=>{n.innerHTML="",n.append(...t.map((e=>{let n=g("button","remove","×"),i=f(`tag type-${e.type}`,[e.name,n]);return n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),t=t.filter((t=>t!==e)),c(),requestAnimationFrame((()=>a.focus()))})),i}))),d()},d=()=>{let e=a.value.toLowerCase(),n=l.filter((n=>!t.includes(n)&&(n.name.toLowerCase().includes(e)||n.slug.includes(e))));o.innerHTML="",o.append(...n.map(((e,n)=>{let s=g("button",`tag type-${e?.type} ${n?"":"selected"}`,e?.name||e.slug);return s.addEventListener("click",(()=>{t.push(e),a.value="",i.check(),c(),requestAnimationFrame((()=>a.focus()))})),s})).filter((e=>e)))};a.addEventListener("input",d),a.addEventListener("keydown",(e=>{if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)return;if("Backspace"===e.key&&!a.value&&t.length)return t.pop(),c(),void e.preventDefault();let n=o.querySelector(".selected"),i=a.selectionStart===a.selectionEnd&&a.selectionStart===a.value.length;if("ArrowDown"===e.key||"ArrowUp"===e.key||i&&("ArrowLeft"===e.key||"ArrowRight"===e.key)){let t="ArrowDown"===e.key||"ArrowRight"===e.key,a=n?.[t?"nextElementSibling":"previousElementSibling"]||o[t?"firstElementChild":"lastElementChild"];n?.classList.remove("selected"),a?.classList.add("selected"),e.preventDefault()}else"Enter"===e.key&&(n?.click(),e.preventDefault())}));let u;s.addEventListener("focusin",(()=>{cancelAnimationFrame(r),o.classList.add("visible")})),s.addEventListener("focusout",(()=>{cancelAnimationFrame(r),r=requestAnimationFrame((()=>o.classList.remove("visible")))})),document.body.append(o);let p=new MutationObserver((()=>{document.contains(s)&&(u=function(e,t){let n=()=>{let n=t.getBoundingClientRect();e.style.left=n.left+"px",e.style.bottom=window.innerHeight-n.top+"px",e.style.width=n.width+"px"},a=[window],i=t;do{i=i.parentNode,K(i)&&a.push(i)}while(i.parentNode&&i.parentNode!==document);let s=new ResizeObserver(n);return a.forEach((e=>{e.addEventListener("scroll",n,{passive:!0}),e!==window&&s.observe(e)})),n(),{stop:()=>{s.disconnect(),a.forEach((e=>e.removeEventListener("scroll",n)))}}}(o,s),p.disconnect(),p=null)}));return p.observe(document,{childList:!0,subtree:!0}),c(),{dom:s,get value(){return t},set value(e){t=e,c()},dispose:()=>{p?.disconnect(),u?.stop(),i.stop(),document.body.removeChild(o)}}}async function J(e={}){let t;(e=Object.assign({},e)).hiddenMaps=e.hiddenMaps.slice(),e.tags=e.tags.slice();let n=new Promise((e=>t=e)),a=[],i=!1,s=e=>{i||(i=!0,a.forEach((e=>e.stop())),x?.dispose(),document.body.removeChild(l)),t(e)},l=f("filters-modal"),o=f("content"),r=g("h2",null,"FILTERS"),c=f("buttons"),d=g("button","cancel","Cancel"),u=g("button","ok","OK"),p=f("scroller"),h=v(null,e.scoreFrom),m=v(null,e.scoreTo),y=f("filter score",["Only show maps if the potential score is between ",h,"% and ",m,"%"]),w=v(null,e.starsFrom),C=v(null,e.starsTo),A=f("filter stars",["Only show maps if their ★ difficulty is between ",w," and ",C]),k=g("select",null,e.hiddenMaps.map((e=>{let t=G[e];if(!t)return;let n=t.name+" - "+t.artist+" ("+t.mapper+") | "+t.diff;return b(n,e)})));k.size=6,k.multiple=!0;let S=g("button",null,"Unhide selected");S.disabled=!0;let I=f("filter hidden-maps",["Hide these specific maps (right click on a map to add it to this list):",k,S]),x=j(e.tags),E=f("filter tags",["Only show maps with these BeatSaver tags:",x.dom]),L=()=>{h.value=+h.value||0,m.value=!m.value||isNaN(+m.value)?"Infinity":+m.value,w.value=+w.value||0,C.value=!C.value||isNaN(+C.value)?"Infinity":+C.value,a.forEach((e=>e.check()))};return[h,m,w,C].forEach((e=>e.addEventListener("change",L))),L(),a.push(...[h,m,w,C].map(R)),k.addEventListener("change",(()=>S.disabled=!k.selectedOptions.length)),S.addEventListener("click",(()=>{let e=k.selectedIndex;[...k.selectedOptions].forEach((e=>k.removeChild(e))),k.selectedIndex=Math.min(e,k.length-1)})),u.addEventListener("click",(()=>{L(),s({scoreFrom:+h.value,scoreTo:+m.value,starsFrom:+w.value,starsTo:+C.value,hiddenMaps:[...k.options].map((e=>+e.value)),tags:x.value})})),d.addEventListener("click",(()=>s(null))),l.addEventListener("click",(e=>{o.contains(e.target)||s(null)})),p.append(y,A,I,E),c.append(d,u),o.append(r,p,c),l.append(o),document.body.append(l),function(e){let t=e.querySelector(":is(input:not([type=hidden]), select, textarea, button):not([disabled])")||e;t?.focus()}(l),n}!function(){U={scoreFrom:0,scoreTo:1/0,starsFrom:0,starsTo:1/0,hiddenMaps:[],tags:[]};try{let e=function(e){let t=JSON.parse(e,((e,t)=>/^-?Infinity$/.test(t)?+t:t));return t.tags=t.tags?.map?.((e=>l.find((t=>t.slug===e)))).filter((e=>e)),t}(localStorage.getItem("peepee-filters"));Object.assign(U,e),U.scoreFrom=+U.scoreFrom||0,U.scoreTo=isNaN(+U.scoreTo)?1/0:+U.scoreTo,U.starsFrom=+U.starsFrom||0,U.starsTo=isNaN(+U.starsTo)?1/0:+U.starsTo,Array.isArray(U.hiddenMaps)||(U.hiddenMaps=[]),Array.isArray(U.tags)||(U.tags=[])}catch(e){}}();let Q=[];async function W(e=[]){let t;e=JSON.parse(JSON.stringify(e));let n=new Promise((e=>t=e)),a=!1,i=e=>{a||(a=!0,window.removeEventListener("resize",M),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",O),document.body.removeChild(s)),t(e)},s=f("custom-curve-modal"),l=f("content"),o=g("h2",null,"CUSTOM CURVE EDITOR"),c=f("buttons"),p=g("button","cancel","Cancel"),h=g("button","ok","OK"),m=f("scroller"),v=f("instructions","Left click to add or move points, right click to remove points"),b=f("editor"),w=g("canvas","preview"),C=w.getContext("2d"),A=f("points"),k=1.12,S=null,I=!1,x=e=>({x:d(e.at/15,34,w.width),y:d(e.value/k,w.height-20,0)}),E=e=>({at:15*u(e.x,34,w.width),value:k*u(e.y,w.height-20,0)}),L=()=>{if(re(C,{numPoints:0,marginX:34,marginY:20,maxPercentage:k,maxStars:15,playerSongsColor:"rgbs(136, 238, 255, .7)"}),e.length){C.strokeStyle="rgba(250, 120, 20, 1)",C.lineWidth=2,C.beginPath();let t=x({at:0,value:e[0].value});C.moveTo(t.x,t.y),e.forEach((e=>{let t=x(e);C.lineTo(t.x,t.y)}));let n=x({at:15,value:e[e.length-1].value});C.lineTo(n.x,n.y),C.stroke(),C.fillStyle="rgba(20, 250, 120, 1)",C.strokeStyle="rgba(20, 250, 120, 1)",e.forEach((e=>{let t=x(e);C.fillRect(t.x-3,t.y-3,6,6),e===S&&(C.beginPath(),C.arc(t.x,t.y,8,0,2*Math.PI),C.stroke())})),C.lineWidth=1}},P=()=>{e.sort(((e,t)=>e.at-t.at)),A.innerHTML="",e.forEach((e=>{let t=f("point"),n=f("at",[y("label","At: "),y("value",r(e.at,2)+"★")]),a=f("score",[y("label","Score: "),y("value",r(100*e.value,2)+"%")]);t.append(n,a),A.append(t)}))},T=t=>{if(!e.length)return;let n=w.getBoundingClientRect(),a=t.clientX-n.left,i=t.clientY-n.top;if(I){t.preventDefault();let e=E({x:a,y:i});return Object.assign(S,e),P(),void L()}let s=e.map((e=>{let t=x(e),n=a-t.x,s=i-t.y;return{point:e,d:n*n+s*s}}));s.sort(((e,t)=>e.d-t.d));let l=s[0].d<81?s[0].point:null;S!==l&&(S=l,L())};document.addEventListener("mousemove",T),w.addEventListener("mousedown",(t=>{if(t.preventDefault(),2===t.button)return e=e.filter((e=>e!==S)),S=null,P(),void L();if(!S){let n=E({x:t.offsetX,y:t.offsetY});e.push(n),S=n,P(),L()}I=!0})),w.addEventListener("contextmenu",(e=>e.preventDefault()));let O=()=>{I=!1};document.addEventListener("mouseup",O);let M=()=>{w.width=w.clientWidth,w.height=w.clientHeight,L()};return window.addEventListener("resize",M),h.addEventListener("click",(()=>i(e))),p.addEventListener("click",(()=>i(null))),s.addEventListener("click",(e=>{l.contains(e.target)||i(null)})),b.append(w,A),m.append(v,b),c.append(p,h),l.append(o,m,c),s.append(l),document.body.append(s),P(),M(),n}function q(e,t,n){let a=[];return n&&a.push("t="+encodeURIComponent(n)),a.push("i="+encodeURIComponent(e.map((e=>e.uid)).join("."))),"/custom-playlist/"+(t||"playlist.bplist")+"?"+a.join("&")}async function V(e,t={}){let n,a=new Promise((e=>n=e)),i=!1,s=e=>{(()=>{if(!i){i=!0;try{k.stop(),I.stop(),L.stop()}catch(e){}document.body.removeChild(l)}})(),n(e)},l=f("playlist-modal"),o=f("content"),d=g("h2",null,"CREATE A PLAYLIST"),u=f("buttons"),p=g("button","done","Done"),h=w("#","button file",".bplist"),m=w("#","button playlist-oneclick","OneClick™"),b=f("scroller"),C=v(null,"",t.title),A=f("line playlist-title",["Playlist title: ",C]),k=R(C),S=v(null,"",50);S.type="number",S.min=1,S.max=e.length;let I=R(S),x=f("line count",["Number of items from the top to include in the playlist: ",S]),E=v(null,"",1);E.type="number",E.min=1,E.max=e.length;let L=R(E),P=f("line offset",["Starting from item number: ",E]),T=y(null,"selection"),O=y(null,"0pp"),M=f("line pp",["Estimated PP gain for ",T,": ",O]),D=f("playlist warning",["Warning: too many maps - OneClick™ will likely not work (you can still download the .bplist)"]),F=()=>{let n=C.value.trim()||t.title||"",a=n.toLowerCase().replace(/[\W-]+/g,"-").replace(/^-+|-+$/,"")||"playlist";a+=".bplist";let i=E.value.trim(),s=c(!i||Number.isNaN(+i)?1:Math.floor(i),1,e.length)-1,l=S.value.trim(),o=c(!l||Number.isNaN(+l)?50:Math.floor(l),1,e.length),d=e.slice(s,s+o),u=d.filter(((e,t,n)=>e.id&&n.findIndex((t=>t.id===e.id))===t)),p="";if(0===s){p=(d.length===e.length?"all":"top")+" "+d.length+" leaderboard"+(1!==d.length?"s":"")}else if(1===d.length)p="leaderboard at position "+(s+1);else{p="leaderboards from "+(s+1)+" to "+(s+d.length)+", inclusive"}u.length!==d.length&&(p+=" (from "+u.length+" unique song"+(1!==u.length?"s":"")+")"),T.textContent=p;let g=ae(d.map((e=>e.uid)),d.map((e=>e.estimatePP||0)));O.textContent="+"+r(Math.max(g-$,0),2)+"pp",h.href=function(e,t){let n=e.map((e=>({hash:e.id,songName:e.name,difficulties:[{characteristic:"Standard",name:e.diff}]}))),a={playlistTitle:t,playlistAuthor:"Peepee",image:"data:image/png;base64,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",songs:n},i="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a));return i}(d,n),h.download=a,m.href=q(d,a,n),m.href="bsplaylist://playlist/"+encodeURIComponent(m.href);let f=m.href.length>7500;D.style.display=f?"block":"none"};return C.addEventListener("input",F),S.addEventListener("input",F),E.addEventListener("input",F),F(),p.addEventListener("click",(()=>s(null))),l.addEventListener("click",(e=>{o.contains(e.target)||s(null)})),u.append(h,m,p),b.append(A,x,P,M,D),o.append(d,b,u),l.append(o),document.body.append(l),S.focus(),a}!function(){try{let e=JSON.parse(localStorage.getItem("peepee-custom-curve"));Array.isArray(e)&&(Q=e)}catch(e){}}();let z={},Y={},G={},Z=Date.now(),X=0,_=x(),$=0;function ee(e){let t=G[e.uid];return t&&Object.assign({},t,e)}async function te(n,a){if(!n)throw new Error("No user ID specified");if((a=a||{}).useCache)try{let e=JSON.parse(localStorage.getItem("cached-v2-"+n));if(e)return e}catch(e){}let i=await S(n);"function"==typeof a.onUserInfo&&a.onUserInfo(i);let s=1,l=[],o={};for(let r=!0;r;s++){let c=t;"function"==typeof a.onProgress&&a.onProgress({page:s,amount:c,currentScores:l,user:i});let d=await I(n,s,"top",c);if(!d)break;d=d.filter((e=>e.userPP)),l.push(...d);let u=d.length;d=d.map(ee).filter((e=>e)),d.forEach((e=>o[e.uid]=e)),u===t?await C(e):r=!1}if(a.useCache)try{localStorage.setItem("cached-"+n,JSON.stringify({user:i,scores:o}))}catch(e){}return{user:i,scores:o,rawScores:l}}function ne(e,t){Ce.elements=Object.values(t).map((e=>({...e}))),we.elements=e.list.filter((e=>!(e.uid in t))).map((e=>({...e}))),Ce.update(),we.update(),re(),le.parentElement.classList.add("show")}function ae(e,t){Array.isArray(e)||(e=e?[e]:[]);let a=Object.values(Y);e.length&&(a=a.filter((t=>!e.includes(t.uid))));let i=a.map((e=>e.userPP)).concat(t).sort(((e,t)=>t-e)),s=1;return i.reduce(((e,t,a)=>e+t*(s*=a?n:1)),0)}function ie(e,t,n){return e.waiting=!!n,e.score&&e.score>=t?(e.estimateScore=e.score,e.estimatePP=e.userPP,void(e.estimateFull=$)):t?(e.estimateScore=t,e.estimatePP=e.pp*P(t,i),void(e.estimateFull=ae(e.uid,e.estimatePP))):(e.estimateScore=0,e.estimatePP=0,void(e.estimateFull=$))}function se(e){let t=Date.now(),n=Object.values(Y),a=Math.max(...n.map((e=>e.stars))),i=n.reduce(((n,a)=>{let i=2*Math.abs(e-a.stars),s=e>a.stars?i*i*i:1,l=a.at||t,o=1/(1+i*(1+Math.max(t-l,0)/1296e6)*s);return n.weight+=o,n.sum+=a.score*o,n}),{weight:0,sum:0}),s=i.weight?i.sum/i.weight:0;if(e>a){let t=2*Math.abs(e-a);s/=1+t*t}return s}let le=document.getElementById("score-est-curve"),oe=le.getContext("2d");function re(e,t){t=t||{};let n=(e=e||oe).canvas;e.clearRect(0,0,n.width,n.height),t.background&&(e.fillStyle=!0===t.background?"#1e1f26":t.background,e.fillRect(0,0,n.width,n.height)),e.strokeStyle="white";let a="number"==typeof t.numPoints?t.numPoints:100,i=t.maxStars||15,s=t.maxPercentage||1.12,l=t.marginX||34,o=t.marginY||20;e.fillStyle="white",e.font='12px Calibri,Candara,Segoe,"Segoe UI",Optima,Arial,sans-serif',e.textBaseline="middle",e.textAlign="right",[...Array(5)].forEach(((t,a)=>{a+=1,e.fillText(20*a+"%",l-4,(n.height-o)*(1-a/5/s),l-4)})),e.textBaseline="top",e.textAlign="left",e.fillText("star diff",0,n.height-o+4),e.textAlign="center",[...Array(i-1)].forEach(((t,a)=>{let s=a+1;e.fillText(s,l+(n.width-l)*s/i,n.height-o+4)})),e.strokeStyle="rgba(255, 255, 255, .1)",e.beginPath(),[...Array(11)].forEach(((t,a)=>{a+=1;let i=(n.height-o)*(1-a/10/s);e.moveTo(l,i),e.lineTo(n.width,i)})),e.stroke(),e.strokeStyle="white",e.beginPath(),e.moveTo(l,0),e.lineTo(l,n.height-o),e.lineTo(n.width,n.height-o),e.stroke(),e.fillStyle=t.playerSongsColor||"rgba(120, 10, 0, .9)",e.globalCompositeOperation="lighter",Object.values(Y).forEach((t=>{let a=l+t.stars/i*(n.width-l),r=(n.height-o)*(1-t.score/s);e.fillRect(a-1,r-1,2,2)})),e.globalCompositeOperation="source-over",e.beginPath();for(let t=0;t<a;t++){let r=t/(a-1),c=se(r*i),d=l+r*(n.width-l),u=(n.height-o)*(1-c/s);e.lineTo(d,u)}e.stroke()}let ce=document.getElementById("last-update");let de={avatar:document.querySelector(".player .avatar"),flag:document.querySelector(".player .flag"),name:document.querySelector(".player .name"),rank:document.querySelector(".player .rank"),pp:document.querySelector(".player .pp"),best:document.querySelector(".player .stats .best"),median:document.querySelector(".player .stats .median")};function ue(){de.avatar.style.backgroundImage="url("+z.avatar+")";let e="https://twemoji.maxcdn.com/v/13.1.0/svg/"+[...z.country.toLowerCase()].map((e=>(e.codePointAt(0)+127365).toString(16))).join("-")+".svg";de.flag.style.backgroundImage="url("+e+")",de.name.textContent=z.name,de.name.href="https://scoresaber.com/u/"+z.id,de.rank.textContent=z.rank.toLocaleString(),de.pp.textContent=z.pp.toLocaleString();let t=Object.values(Y).map((e=>e.rank)).sort(((e,t)=>e-t)),n=t[~~(t.length/2)]||0,a=t[0]||0,i=t.findIndex((e=>e!==a));-1===i&&(i=t.length),de.best.textContent=a.toLocaleString(),de.best.title=i.toLocaleString()+" leaderboard"+(1===i?"":"s"),de.median.textContent=n.toLocaleString()}let pe=0;class he{constructor(e){this.list=e,this.async=!1,this.name="???",this.id="unknown"}createOptionsMarkup(){}onShow(){}onHide(){}init(){}run(e){ie(e,0)}}let me={};class ge extends he{constructor(e){super(e),this.name="Custom curve",this.id="custom-curve"}createOptionsMarkup(){let e=f("custom-curve-sort-buttons"),t=g("button","custom-curve-edit","edit curve");return t.tabIndex=-1,t.addEventListener("click",(async()=>{let e=await W(Q);e&&async function(e){Q=e;try{localStorage.setItem("peepee-custom-curve",JSON.stringify(e))}catch(e){}[Ce,we].forEach((e=>{e.method instanceof ge&&e.update()}))}(e)})),e.append(t),this.editButton=t,e}onShow(){this.editButton.tabIndex=0}onHide(){this.editButton.tabIndex=-1}run(e){ie(e,P(e.stars,Q))}}let fe=[class extends he{constructor(e){super(e),this.name="Score est.",this.id="estimate"}run(e){ie(e,se(e.stars))}},class extends he{constructor(e){super(e),this.async=!0,this.name="Score at rank",this.id="rank"}createOptionsMarkup(){let e=g("form","rank-form");e.addEventListener("submit",(e=>{e.preventDefault(),this.triggerUpdate()})),this.rankInput=g("input","rank-input"),this.rankInput.type="text",this.rankInput.placeholder=(z.rank||1).toLocaleString()+" (desired rank)",this.rankInput.tabIndex=-1,this.rankInput.addEventListener("change",(()=>this.triggerUpdate())),e.appendChild(this.rankInput);let t=g("button","rank-submit");return t.type="submit",t.tabIndex=-1,e.appendChild(t),e}onShow(){this.rankInput.tabIndex=0}onHide(){this.rankInput.tabIndex=-1}triggerUpdate(){this.list.method===this&&this.list.update()}init(e){e.sort(((e,t)=>t.stars-e.stars)),e.forEach((e=>ie(e,0,!0))),this.rankInput.placeholder=(z.rank||1).toLocaleString()+" (desired rank)",this.rank=~~+this.rankInput.value.replace(/,/g,""),(!this.rank||this.rank<=0)&&(this.rank=z.rank||9999999),pe=0}async run(t,n){let i=this.rank,s="scoreAtRank"+i,l=!1;if(!Object.prototype.hasOwnProperty.call(t,s)){let e=0,n=t.scores;"string"==typeof n&&(n=+n.replace(/,/g,"")||1/0),i<=n+100&&i<(+t.rank||1/0)&&(e=await E(t,i),pe++,l=!0),t[s]=e}if(!n()){if(ie(t,t[s]||0),pe>=500)return a;l&&await C(e)}}},class extends he{constructor(e){super(e),this.name="Fixed score",this.id="raw",this.score=.94333333}createOptionsMarkup(){let e=g("form","fixed-form");e.addEventListener("submit",(e=>e.preventDefault())),this.fixedInput=g("input","fixed-input"),this.fixedInput.type="text",this.fixedInput.placeholder="94.3333%",this.fixedInput.maxLength=10,this.fixedInput.tabIndex=-1,this.fixedInput.addEventListener("change",(()=>{this.list.method===this&&this.list.update()})),e.appendChild(this.fixedInput);let t=g("button","fixed-submit");return t.type="submit",t.tabIndex=-1,e.appendChild(t),e}onShow(){this.fixedInput.tabIndex=0}onHide(){this.fixedInput.tabIndex=-1}init(){this.score=parseFloat(this.fixedInput.value.trim())/100||.94333333,this.score<=0&&(this.score=.01)}run(e){ie(e,this.score)}},ge,class extends he{constructor(e){super(e),this.name="Compare",this.id="compare"}createOptionsMarkup(){let e=g("form","compare-form");e.addEventListener("submit",(e=>e.preventDefault())),this.compareInput=g("input","compare-input"),this.compareInput.type="text",this.compareInput.placeholder="compared profile url",this.compareInput.tabIndex=-1;let t=()=>{let t=this.compareInput.value.match(/\d{5,}/);t?(this.compareInput.value=t[0],this.list.method===this&&this.list.update()):o(e,"invalid")};this.compareInput.addEventListener("change",t),this.compareInput.addEventListener("paste",(()=>setTimeout(t,0))),this.compareInput.addEventListener("focus",(()=>this.compareInput.select())),e.appendChild(this.compareInput);let n=g("button","compare-auto","auto");n.type="button",n.tabIndex=-1,n.addEventListener("click",(async()=>{n.disabled=!0;let e=1===z.rank?2:Math.floor(.9*z.rank),a=await L(e);this.compareInput.value=a||"",n.disabled=!1,t()})),e.appendChild(n),this.autoButton=n;let a=g("button","compare-submit");return a.type="submit",a.tabIndex=-1,e.appendChild(a),e}onShow(){this.compareInput.tabIndex=this.autoButton.tabIndex=0}onHide(){this.compareInput.tabIndex=this.autoButton.tabIndex=-1}async init(e){e.sort(((e,t)=>t.pp-e.pp)),e.forEach((e=>ie(e,0,!0))),this.userId=this.compareInput.value,this.userId&&!me[this.userId]&&(me[this.userId]=te(this.userId));try{let e=await me[this.userId];this.user=e.user,this.scores=e.scores}catch(e){this.user={},this.scores={}}}run(e){ie(e,(this.scores[e.uid]||{}).score||0)}}],ye=fe,ve=fe.concat(class extends he{constructor(e){super(e),this.name="Worst rank",this.id="worstrank"}run(e){ie(e,se(e.stars))}sort(e){return e.sort(((e,t)=>(t.rank||0)-(e.rank||0)||t.pp-e.pp))}},class extends he{constructor(e){super(e),this.name="Best rank",this.id="bestrank"}run(e){ie(e,se(e.stars))}sort(e){return e.sort(((e,t)=>(e.rank||0)-(t.rank||0)||t.pp-e.pp))}},class extends he{constructor(e){super(e),this.name="Worst score",this.id="worstscore"}run(e){ie(e,se(e.stars))}sort(e){return e.sort(((e,t)=>(e.score||0)-(t.score||0)||e.pp-t.pp))}},class extends he{constructor(e){super(e),this.name="Best score",this.id="bestscore"}run(e){ie(e,se(e.stars))}sort(e){return e.sort(((e,t)=>(t.score||0)-(e.score||0)||t.pp-e.pp))}},class extends he{constructor(e){super(e),this.name="Oldest score",this.id="oldestscore"}run(e){ie(e,se(e.stars))}sort(e){return e.sort(((e,t)=>(e.at||0)-(t.at||0)||e.pp-t.pp))}});class be{constructor(e,t,n,a=[]){this.elem=e,this.title=t,this.selection=[],this.methods=n.map((e=>new e(this))),this.method=this.methods[0],this.elements=a,this.displayedPageSize=200,this.displayed=this.displayedPageSize,e.innerHTML="";let i=f("list-header");this.selectionTooltip=f("list-selection-tooltip");let s=f("first-line");this.mapCount=y("selection-map-count","0 maps");let l=g("button","selection-clear","clear");l.onclick=this.clearSelection.bind(this),s.append("Selection: ",this.mapCount," (",l,")"),this.selectionTooltip.appendChild(s),this.selectionTooltipPP=f("line","+0.00pp"),this.selectionTooltip.appendChild(this.selectionTooltipPP),this.selectionTooltipBplist=w("#","bplist",".bplist"),this.selectionTooltipOneClick=w("#","playlist-oneclick","OneClick");let o=f("selection-playlist",[this.selectionTooltipBplist," - ",this.selectionTooltipOneClick]);this.selectionTooltip.appendChild(o),i.appendChild(this.selectionTooltip);let r=f("list-title",t);this.titleEl=r;let c=g("button","playlist","playlist","Create a playlist");c.onclick=this.createPlaylist.bind(this),r.appendChild(c),i.appendChild(r);let d=f("method-wrapper"),u=f("method"),p=g("select");this.methods.forEach(((e,t)=>{let n=b(e.name,t);p.appendChild(n)})),p.onchange=()=>{this.changeMethod(this.methods[p.value])},u.appendChild(p);let h=g("button","unpause","","Keep going");h.addEventListener("click",(()=>{this.updating||this.update()})),u.appendChild(h),d.appendChild(u),this.methods.forEach((e=>{let t=e.createOptionsMarkup();t&&d.appendChild(t)})),i.appendChild(d),e.appendChild(i),this.content=f("list-content"),this.content.addEventListener("click",this.onContentClick.bind(this)),this.content.addEventListener("contextmenu",this.onContextMenu.bind(this)),this.content.addEventListener("scroll",this.onScroll.bind(this)),e.appendChild(this.content),this.updateSelectionTooltip(),this.update(),this.onScroll()}getPlaylistName(){let e=new Date,t=e.getFullYear()+"-"+p(e.getMonth()+1)+"-"+p(e.getDate()),n=this.title.replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();return{title:this.title+" ("+t+")",filename:n+"-"+t+".bplist"}}createPlaylist(){return V(this.getFilteredElements(),this.getPlaylistName())}changeMethod(e){this.method!==e&&(this.method&&(this.elem.classList.remove("method-"+this.method.id),this.method.onHide()),this.content.scrollTop=0,this.displayed=this.displayedPageSize,this.method=e,this.method&&(this.elem.classList.add("method-"+this.method.id),this.method.onShow()),this.update(),this.onScroll())}clearSelection(){this.selection=[],this.updateSelectionTooltip(),[...this.content.querySelectorAll(".list-element-selected")].forEach((e=>e.classList.remove("list-element-selected")))}updateSelectionTooltip(){let e=this.selection.map((e=>this.elements.find((t=>e===t.uid)))).filter((e=>e));this.selection=e.map((e=>e.uid));let t=e.length;this.mapCount.textContent=t+" map"+(1===t?"":"s");let n=ae(e.map((e=>e.uid)),e.map((e=>e.estimatePP)));this.selectionTooltipPP.textContent="+"+r(Math.max(n-$,0),2)+"pp",this.selectionTooltip.classList[t?"add":"remove"]("show");let a=this.getPlaylistName();this.selectionTooltipBplist.href=q(e,a.filename,a.title),this.selectionTooltipOneClick.href="bsplaylist://playlist/"+encodeURIComponent(this.selectionTooltipBplist.href)}getClosestElement(e){for(;e&&!e.classList.contains("list-element")&&this.content.contains(e);)e=e.parentElement;return e&&e.classList.contains("list-element")?e:null}toggleSelection(e,t){if(!e)return;let n=this.selection.includes(e);if("boolean"!=typeof t&&(t=!n),t===n)return;t?this.selection.push(e):this.selection=this.selection.filter((t=>t!==e));let a=this.content.querySelector('[data-uid="'+e+'"]');a&&a.classList[t?"add":"remove"]("list-element-selected"),this.updateSelectionTooltip()}onContentClick(e){if((e.ctrlKey||e.metaKey)&&!e.target.matches("a, button")){let t=this.getClosestElement(e.target),n=t&&+t.getAttribute("data-uid");this.toggleSelection(n)}}onContextMenu(e){if(e.ctrlKey||e.metaKey||e.target.matches("a, button")||!window.ContextMenu)return;let t=this.getClosestElement(e.target),n=t&&+t.getAttribute("data-uid");if(!n)return;e.preventDefault(),e.stopPropagation();let a=this.selection.includes(n);window.ContextMenu.show([{text:(a?"Deselect":"Select")+" map",shortcut:"Ctrl+Click",action:()=>this.toggleSelection(n)},{text:"Screw this (hide map)",action:()=>async function(e){let t=U.hiddenMaps||[];t.push(e),H({...U,hiddenMaps:t})}(n)},{separator:!0},{text:"Show help",action:Se}],{x:e.clientX,y:e.clientY})}onScroll(){this.displayed<this.elements.length&&this.content.scrollTop+this.content.clientHeight>this.content.scrollHeight-50&&this.displayMore()}displayMore(){this.displayed>=this.elements.length||(this.displayed+=this.displayedPageSize,this.refresh())}createMarkup(e){let t=f("list-element");t.setAttribute("data-uid",e.uid);let n=f("list-element-content-left"),a=f("list-element-pic");a.style.backgroundImage="url(https://cdn.scoresaber.com/covers/"+e.id+".png)",n.appendChild(a);let i=f("list-element-name-group"),l=f("list-element-name-and-artist");l.title=e.name+" - "+e.artist,l.appendChild(y("list-element-name",(e.name||"")+" ")),l.appendChild(y("list-element-sep")),l.appendChild(y("list-element-artist",e.artist)),e._nameAndArtist=l,i.appendChild(l),i.appendChild(f("list-element-mapper",e.mapper));let o=e.diff||"Easy",c=s[o]||{},d=f("list-element-difficulty-and-score");if(d.appendChild(y("list-element-difficulty "+(c.className||o.toLowerCase()),(c.display||o)+" ")),e.score||0===e.score){let t=y("list-element-score-and-rank");if(t.appendChild(y("list-element-score",[r(100*e.score,2),y("percent-sign","% ")])),e.at){let n=new Date(e.at);t.appendChild(y("list-element-at",m(n)+" ",h(n)))}t.appendChild(y("list-element-sep")),t.appendChild(y("list-element-rank",e.rank.toLocaleString())),d.appendChild(t)}i.appendChild(d),n.appendChild(i),t.appendChild(n);let u=f("list-element-content-middle");u.appendChild(f("pot-title","Potential")),e._potScore=f("pot-score"),u.appendChild(e._potScore);let p=f("pot-pp");e._potPP=y("raw"),p.appendChild(e._potPP),e._potInc=y("increase",null,"Total (weighted) pp change"),p.appendChild(e._potInc),u.appendChild(p),t.appendChild(u);let v=f("list-element-content-right"),b=f("important");b.appendChild(f("star-difficulty",e.stars,"Star difficulty")),void 0!==e.upvotes&&b.appendChild(f("upvotes",e.upvotes,"Upvotes")),void 0!==e.downvotes&&b.appendChild(f("downvotes",e.downvotes,"Downvotes")),v.appendChild(b);let C=f("secondary");(e.duration||e.durationSeconds)&&C.appendChild(f("duration",function(e){let t=e.durationSeconds||60*e.duration/e.bpm;return Math.floor(t/60)+":"+("0"+Math.round(t%60)).slice(-2)}(e),"Duration")),e.bpm&&C.appendChild(f("bpm",r(e.bpm,2),"BPM")),v.appendChild(C);let A=f("links");if(e.beatSaverKey){let t=g("button","bsr",null,"Copy !bsr request");t.addEventListener("click",(()=>function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}("!bsr "+e.beatSaverKey))),A.appendChild(t)}e.download&&A.appendChild(w(e.download,"download",null,"Download map","_blank")),e.beatSaverKey&&(A.appendChild(w("beatsaver://"+e.beatSaverKey,"oneclick",null,"OneClick™ install")),A.appendChild(w("https://beatsaver.com/beatmap/"+e.beatSaverKey,"beatsaver",null,"Open on BeatSaver","_blank"))),A.appendChild(w("https://scoresaber.com/leaderboard/"+e.uid,"leaderboards",null,"ScoreSaber leaderboard","_blank")),v.appendChild(A),t.appendChild(v),e.markup=t}async update(){let e=this.elements,t=e.length;this.titleEl.title=t+" leaderboard"+(1===t?"":"s");let n=this.method,i=Date.now();this.elem.classList.remove("paused"),this.updating&&this.elem.classList.remove("loading"),this.updating=i,this.elem.classList.add("loading"),await n.init(e),this.refresh();let s=()=>this.updating!==i,l=Date.now(),o=!1;for(let t=0;t<e.length;t++){let i=await n.run(e[t],s);if(n.async){if(s())return;let e=Date.now();e-l>1e3?(l=e,this.refresh(),o=!1):o=!0}if(i===a){this.elem.classList.add("paused");break}}this.elem.classList.remove("loading"),n.async&&!o||this.refresh(),this.updating=!1}defaultSort(e){return e.sort(((e,t)=>(t.estimateFull||0)-(e.estimateFull||0)||t.pp-e.pp))}filter(e){return(!U.hiddenMaps||!U.hiddenMaps.includes(e.uid))&&(!(e.estimateScore<U.scoreFrom||e.estimateScore>U.scoreTo)&&(!(e.stars<U.starsFrom||e.stars>U.starsTo)&&!(this.selectedTagsPerType&&!this.selectedTagsPerType.every((t=>t.some((t=>e.tags?.includes(t.slug))))))))}getFilteredElements(){return U.tags?.length?this.selectedTagsPerType=Object.values(U.tags.reduce(((e,t)=>(e[t.type]=e[t.type]||[],e[t.type].push(t),e)),{})):this.selectedTagsPerType=null,this.elements.filter(this.filter,this)}refresh(){this.content.innerHTML="";let e=this.method.sort||this.defaultSort;this.elements=e(this.elements);const t=this.getFilteredElements();if(t.slice(0,this.displayed).forEach(((e,t)=>{e.markup||this.createMarkup(e),void 0===e.estimateScore&&ie(e,0),e._potScore.textContent=e.waiting?"...":r(100*e.estimateScore,2),e._potPP.textContent=e.waiting?"...":r(e.estimatePP,2),e._potInc.textContent=e.waiting?"...":r(Math.max(e.estimateFull-$,0),2),e._nameAndArtist.setAttribute("data-position",t+1),this.content.appendChild(e.markup)})),this.displayed>=t.length&&t.length!==this.elements.length){const e=this.elements.length-t.length,n=g("button","","Edit your filters");n.addEventListener("click",Ie);const a=f("warning",[`${e} element${1!==e?"s have":" has"} been hidden from this list. `,n," to show more."]);this.content.appendChild(a)}}}let we=new be(document.querySelector(".list.unplayed"),"Not played",ye),Ce=new be(document.querySelector(".list.played"),"To improve",ve);async function Ae(e){if(e&&e.preventDefault&&e.preventDefault(),T.classList.contains("loading"))return;let t=O.value.match(/\d{5,}/);if(!t)return void o(T,"invalid");let n=t[0];M.textContent="Getting user infos...",T.classList.add("loading"),O.disabled=!0,Z=Date.now();try{let e,t=await _;G=t.list.reduce(((e,t)=>(e[t.uid]=t,e)),{});let a={useCache:location.search.includes("debug"),onProgress:({currentScores:e,amount:t,user:n})=>M.textContent="Getting scores "+Math.min(e.length+t,+n.rankedPlays||0)+"/"+n.rankedPlays+" ...",onUserInfo:e=>B(e)};if(e=await te(n,a),!e)return void o(T,"invalid");z=e.user,Y=e.scores,$=ae(0,0),ue(),ne(t,Y),window.playerSongs=Y,document.body.classList.add("step-results","user-"+n)}catch(e){console.error(e),o(T,"invalid")}O.disabled=!1,T.classList.remove("loading")}T.addEventListener("submit",Ae),O.addEventListener("paste",(()=>setTimeout(Ae,0))),O.addEventListener("focus",(()=>O.select()));let ke=document.getElementById("show-help");function Se(){ke.checked=!ke.checked}async function Ie(){let e=await J(U);e&&H(e)}document.getElementById("back").addEventListener("click",(()=>{O.value="",document.body.classList.remove("step-results")})),document.getElementById("refresh").addEventListener("click",(async function(){if(!z||!z.id)return;document.body.classList.add("refreshing");try{let t=Z;Z=Date.now();let n=await async function(t,n,a){a=a||{};let i=1,s=await S(t);"function"==typeof a.onUserInfo&&a.onUserInfo(s);let l=[];for(let s=!0;s;i++){"function"==typeof a.onProgress&&a.onProgress(i);let o=await I(t,i,"recent",20);if(!o)break;let r=Math.min(...o.map((e=>e.at)));o=o.filter((e=>e.userPP&&e.at>n)),l.push(...o),o=o.map(ee).filter((e=>e)),o.forEach((e=>o[e.uid]=e)),r>=n?await C(e):s=!1}return{user:s,scores:{},rawScores:l}}(z.id,t);z=n.user,Object.assign(Y,n.scores),B(z),$=ae(0,0),ue()}catch(e){}let t=x(new Date(X));try{await t,_=t}catch(e){}ne(await _,Y),document.body.classList.remove("refreshing")})),document.getElementById("show-filters").addEventListener("click",Ie),document.getElementById("export-curve").addEventListener("click",(()=>{let e=document.createElement("canvas");e.width=800,e.height=400,re(e.getContext("2d"),{background:!0,numPoints:500});let t=(z.name||"").replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();!function(e,t){let n=w(e);n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.toDataURL(),t+"-score-curve.png")}))}();
!async function(){const e={GN:.04,DA:.02,FS:.08,NF:-.5,NO:-.05,NB:-.1,SS:-.3,NA:-.3},t=[{at:0,value:0},{at:45,value:.015},{at:50,value:.03},{at:55,value:.06},{at:60,value:.105},{at:65,value:.16},{at:68,value:.24},{at:70,value:.285},{at:80,value:.563},{at:84,value:.695},{at:88,value:.826},{at:94.5,value:1.015},{at:95,value:1.046},{at:100,value:1.12},{at:110,value:1.18},{at:114,value:1.25}],a={ExpertPlus:{className:"expert-plus",display:"Expert+"}};function r(e,t){e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}function n(e,t=0){return e.toFixed(t).replace(/\.?0*$/,"")}function i(e){return("0"+e).slice(-2)}const s=function(){const e=864e5;let t=(e,t)=>~~(e/t),a=(e,t)=>e+" "+t+(1!==e&&-1!==e?"s":"");return r=>function(r,n){let i=n-r,s=Math.abs(i);if(s<6e4)return a(t(i,1e3),"second");if(s<36e5)return a(t(i,6e4),"minute");if(s<e)return a(t(i,36e5),"hour");if(s<2592e6)return a(t(i,e),"day");let o=function(e,t){let a=t.getFullYear()-e.getFullYear();return t.getMonth()-e.getMonth()+12*a}(r,n);return Math.abs(o)<12?a(o,"month"):a(~~(o/12),"year")}(r,new Date)+" ago"}();function o(e,t,a,r){let n=document.createElement(e);return null!=t&&(n.className=t),null!=a&&(n.textContent=a),null!=r&&(n.title=r),n}let l=o.bind(null,"div"),d=(e,t,a,r,n)=>{let i=o("a",t,a,r);return i.href=e,n&&(i.target=n),i};function c(e,t){let a=document.createElement("a");a.download=t,a.href=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}async function u(e){await new Promise(t=>setTimeout(t,e))}function p(...e){return fetch(...e).then(e=>e.json())}async function h(...e){return fetch(...e).then(e=>e.ok?e.text():Promise.reject()).then(e=>{if(-1===e.indexOf("<html"))throw new Error("not an HTML page: "+e);return(new DOMParser).parseFromString(e,"text/html")})}async function m(e,t,a=1,r=2){return h("/proxy/u/"+e+"?sort="+a+"&page="+(t||1)).catch(async n=>{if(r-- >0)return await u(1e3),m(e,t,a,r);throw n})}function g(t){return t?t.split(",").reduce((t,a)=>t+(e[a.trim()]||0),1):1}function f(e){if(!e)return null;let t=e.getAttribute("src");return t.match(/^https?:\/\//)||(t="https://scoresaber.com"+("/"===t[0]?"":"/")+t),t}WebFont.load({custom:{families:["NeonTubes"]}});let y=document.getElementById("user"),A=document.getElementById("profile"),C=document.getElementById("user-fetch-info"),v=[];try{let e=JSON.parse(localStorage.getItem("history"));Array.isArray(e)&&(v=e)}catch(e){}let b=document.querySelector(".history");function k(){b.innerHTML="",v.slice(0,5).forEach(e=>{if(!e||!e.avatar||null==e.rank||!e.name)return;let t=l("line");t.onclick=()=>{A.disabled||(A.value=e.id,_())};let a=l("avatar");a.style.backgroundImage="url("+e.avatar+")",t.appendChild(a),t.appendChild(l("rank",e.rank.toLocaleString())),t.appendChild(l("name",e.name)),b.appendChild(t)})}function w(e){v=v.filter(t=>t&&t.id!==e.id),v.unshift(e),v=v.slice(0,5);try{localStorage.setItem("history",JSON.stringify(v))}catch(e){}k()}k();let I={},S={},x={},E=Date.now(),L=0,P=p("/ranked"),O=0;function D(e,t){let a=t.querySelector("h5.title"),r=a&&a.textContent.trim();if(!r)throw new Error("Invalid Profile");let n=t.querySelector(".avatar img"),i=a.querySelector("img"),s=t.querySelector("h5.title ~ ul"),o=s&&s.textContent||"",l=o.match(/#([\d,]+) /),d=o.match(/([\d,.]+)pp/);return{id:e,name:r,avatar:f(n),country:f(i),rank:l?+l[1].replace(/\D/g,""):0,pp:d?+d[1].replace(/[^\d.]/g,""):0}}function M(e){if(!e)return;let t=e.querySelector("table.ranking.songs tbody");if(!t)throw new Error("Error while parsing results page - maybe scoresaber is having issues?");return[...t.querySelectorAll("tr")].map(e=>{let t=e.querySelector('a[href*="/leaderboard/"]'),a=t&&t.href.match(/\/leaderboard\/(\d+)/);if(!a)return;let r=+a[1],n=e.querySelector(".ppValue"),i=n&&+n.textContent,s=e.querySelector(".rank"),o=s&&s.textContent.match(/#?([\d,]+)/),l=e.querySelector(".time"),d=Date.now();if(l){let e=(l.title||"").replace(/^.*(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2}).*$/,"$1T$2Z");d=+new Date(e)||d}let c=e.querySelector(".ppWeightedValue"),u=c&&c.textContent.match(/([\d.]+)/),p=e.querySelector(".scoreBottom"),h=p&&p.textContent.match(/([\d.]+)%/),m=h&&+h[1]||0,f=p&&p.textContent.match(/\(([^)]+)\)/),y=g(f&&f[1]);return{uid:r,rank:o&&+o[1].replace(/\D/g,"")||1/0,at:d,userPP:i,weighted:u&&+u[1]||0,score:m*y,modScore:m}}).filter(e=>e)}async function T(e,t){if(!e)throw new Error("No user ID specified");if((t=t||{}).useCache)try{let t=JSON.parse(localStorage.getItem("cached-"+e));if(t)return t}catch(e){}let a,r=1,n={};for(let i=!0;i;r++){"function"==typeof t.onProgress&&t.onProgress(r);let s=await m(e,r);1===r&&(a=D(e,s));let o=M(s);if(!o)break;o=o.filter(e=>e.userPP);let l=o.length;o=o.map(e=>{let t=x[e.uid];return t&&Object.assign({},t,e)}).filter(e=>e),o.forEach(e=>n[e.uid]=e),8===l?await u(200):i=!1}if(t.useCache)try{localStorage.setItem("cached-"+e,JSON.stringify({user:a,scores:n}))}catch(e){}return{user:a,scores:n}}function q(e,t){Y.elements=Object.values(t),Z.elements=e.list.filter(e=>!Object.prototype.hasOwnProperty.call(t,e.uid)).map(e=>Object.assign({},e)),Y.update(),Z.update(),U()}function B(e,t){let a=Object.values(S).filter(t=>t.uid!==e).map(e=>e.userPP);t&&a.push(t),a.sort((e,t)=>t-e);let r=1;return a.reduce((e,t,a)=>e+t*(r*=a?.965:1),0)}function F(e,a){if(e.score&&e.score>=a)return e.estimateScore=e.score,e.estimatePP=e.userPP,void(e.estimateFull=O);e.estimateScore=a,e.estimatePP=e.pp*function(e,t){if(!e||e<=0)return 0;let a=t.findIndex(t=>t.at>=e);if(-1===a)return t[t.length-1].value;if(!a)return t[0].value;let r=t[a-1],n=t[a],i=(e-r.at)/(n.at-r.at);return r.value+(n.value-r.value)*i}(a,t),e.estimateFull=B(e.uid,e.estimatePP)}function Q(e){let t=Date.now(),a=Object.values(S),r=Math.max(...a.map(e=>e.stars)),n=a.reduce((a,r)=>{let n=2*Math.abs(e-r.stars),i=e>r.stars?n*n*n:1,s=r.at||t,o=1/(1+n*(1+Math.max(t-s,0)/1296e6)*i);return a.weight+=o,a.sum+=r.score*o,a},{weight:0,sum:0}),i=n.weight?n.sum/n.weight:0;if(e>r){let t=2*Math.abs(e-r);i/=1+t*t}return i}let N=document.getElementById("score-est-curve").getContext("2d");function U(e,t){t=t||{};let a=(e=e||N).canvas;e.clearRect(0,0,a.width,a.height),t.background&&(e.fillStyle=!0===t.background?"#1e1f26":t.background,e.fillRect(0,0,a.width,a.height)),e.strokeStyle="white";let r=t.numPoints||100,n=t.maxStars||15,i=t.maxPercentage||1.12,s=t.marginX||34,o=t.marginY||20;e.fillStyle="white",e.font='12px Calibri,Candara,Segoe,"Segoe UI",Optima,Arial,sans-serif',e.textBaseline="middle",e.textAlign="right",[...Array(5)].forEach((t,r)=>{r+=1,e.fillText(20*r+"%",s-4,(a.height-o)*(1-r/5/i),s-4)}),e.textBaseline="top",e.textAlign="left",e.fillText("star diff",0,a.height-o+4),e.textAlign="center",[...Array(n-1)].forEach((t,r)=>{let i=r+1;e.fillText(i,s+(a.width-s)*i/n,a.height-o+4)}),e.strokeStyle="rgba(255, 255, 255, .1)",e.beginPath(),[...Array(11)].forEach((t,r)=>{r+=1;let n=(a.height-o)*(1-r/10/i);e.moveTo(s,n),e.lineTo(a.width,n)}),e.stroke(),e.strokeStyle="white",e.beginPath(),e.moveTo(s,0),e.lineTo(s,a.height-o),e.lineTo(a.width,a.height-o),e.stroke(),e.fillStyle="rgba(120, 10, 0, .9)",e.globalCompositeOperation="lighter",Object.values(S).forEach(t=>{let r=s+t.stars/n*(a.width-s),l=(a.height-o)*(1-t.score/100/i);e.fillRect(r-1,l-1,2,2)}),e.globalCompositeOperation="source-over",e.beginPath();for(let t=0;t<r;t++){let l=t/(r-1),d=Q(l*n)/100,c=s+l*(a.width-s),u=(a.height-o)*(1-d/i);e.lineTo(c,u)}e.stroke()}let j={avatar:document.querySelector(".player .avatar"),flag:document.querySelector(".player .flag"),name:document.querySelector(".player .name"),rank:document.querySelector(".player .rank"),pp:document.querySelector(".player .pp"),best:document.querySelector(".player .stats .best"),median:document.querySelector(".player .stats .median")};function V(){j.avatar.style.backgroundImage="url("+I.avatar+")",j.flag.style.backgroundImage="url("+I.country+")",j.name.textContent=I.name,j.name.href="https://scoresaber.com/u/"+I.id,j.rank.textContent=I.rank.toLocaleString(),j.pp.textContent=I.pp.toLocaleString();let e=Object.values(S).map(e=>e.rank).sort((e,t)=>e-t),t=e[~~(e.length/2)]||0,a=e[0]||0,r=e.findIndex(e=>e!==a);-1===r&&(r=e.length),j.best.textContent=a.toLocaleString(),j.best.title=r.toLocaleString()+" leaderboard"+(1===r?"":"s"),j.median.textContent=t.toLocaleString()}let W=0;class K{constructor(e){this.list=e,this.async=!1,this.name="???",this.id="unknown"}createOptionsMarkup(){}init(){}run(e){F(e,0)}}let H={};let J=[class extends K{constructor(e){super(e),this.name="Score est.",this.id="estimate"}run(e){F(e,Q(e.stars))}},class extends K{constructor(e){super(e),this.async=!0,this.name="Score at rank",this.id="rank"}createOptionsMarkup(){let e=o("form","rank-form");e.addEventListener("submit",e=>e.preventDefault()),this.rankInput=o("input","rank-input"),this.rankInput.type="text",this.rankInput.placeholder=(I.rank||1).toLocaleString()+" (desired rank)",this.rankInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.rankInput);let t=o("button","rank-submit");return t.type="submit",e.appendChild(t),e}init(e){e.sort((e,t)=>t.stars-e.stars),e.forEach(e=>F(e,0)),this.rankInput.placeholder=(I.rank||1).toLocaleString()+" (desired rank)",this.rank=~~+this.rankInput.value.replace(/,/g,""),(!this.rank||this.rank<=0)&&(this.rank=I.rank||9999999),W=0}async run(e,t){let a=this.rank,r="scoreAtRank"+a,n=!1;if(!Object.prototype.hasOwnProperty.call(e,r)){let t=0,i=e.scores;"string"==typeof i&&(i=+i.replace(/,/g,"")||1/0),a<=i+100&&a<(+e.rank||1/0)&&(t=await async function e(t,a,r=2){if(!t||!a)return console.log("Invalid score at rank request",t,a),0;let n=Math.ceil(a/12),i=a-12*(n-1);try{let e=await h("/proxy/leaderboard/"+t+"?page="+(n||1));if(!e)return 0;let a=e.querySelector(".ranking tbody tr:nth-child("+i+")");if(!a)return 0;let r=a.querySelector(".percentage"),s=(r&&r.textContent||"").match(/[\d.]+/);if(!s)return 0;let o=a.querySelector(".mods"),l=g(o&&o.textContent),d=r&&r.querySelector("span[style*=tomato]");return s[0]*l*(d?110/115:1)}catch(n){return r-- >0?(await u(1e3),e(t,a,r)):(console.log("Error getting score at rank",n),0)}}(e.uid,a),W++,n=!0),e[r]=t}if(!t()){if(F(e,e[r]||0),W>=100)return"PAUSE_UPDATE";n&&await u(200)}}},class extends K{constructor(e){super(e),this.name="Fixed score",this.id="raw",this.score=94.333333}createOptionsMarkup(){let e=o("form","fixed-form");e.addEventListener("submit",e=>e.preventDefault()),this.fixedInput=o("input","fixed-input"),this.fixedInput.type="text",this.fixedInput.placeholder="94.3333%",this.fixedInput.maxLength=10,this.fixedInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.fixedInput);let t=o("button","fixed-submit");return t.type="submit",e.appendChild(t),e}init(){this.score=parseFloat(this.fixedInput.value.trim())||94.333333,this.score<=0&&(this.score=.01)}run(e){F(e,this.score)}},class extends K{constructor(e){super(e),this.name="Compare",this.async=!0,this.id="compare"}createOptionsMarkup(){let e=o("form","compare-form");e.addEventListener("submit",e=>e.preventDefault()),this.compareInput=o("input","compare-input"),this.compareInput.type="text",this.compareInput.placeholder="compared profile url";let t=()=>{let t=this.compareInput.value.match(/\d{5,}/);t?(this.compareInput.value=t[0],this.list.method===this&&this.list.update()):r(e,"invalid")};this.compareInput.addEventListener("change",t),this.compareInput.addEventListener("paste",()=>setTimeout(t,0)),this.compareInput.addEventListener("focus",()=>this.compareInput.select()),e.appendChild(this.compareInput);let a=o("button","compare-submit");return a.type="submit",e.appendChild(a),e}async init(e){e.sort((e,t)=>t.pp-e.pp),e.forEach(e=>F(e,0)),this.userId=this.compareInput.value,H[this.userId]||(H[this.userId]=T(this.userId));try{let e=await H[this.userId];this.user=e.user,this.scores=e.scores}catch(e){this.user={},this.scores={}}}run(e){F(e,(this.scores[e.uid]||{}).score||0)}}],G=J,R=J.concat(class extends K{constructor(e){super(e),this.name="Worst rank",this.id="worstrank"}run(e){F(e,Q(e.stars))}sort(e){return e.sort((e,t)=>(t.rank||0)-(e.rank||0)||t.pp-e.pp)}},class extends K{constructor(e){super(e),this.name="Best rank",this.id="bestrank"}run(e){F(e,Q(e.stars))}sort(e){return e.sort((e,t)=>(e.rank||0)-(t.rank||0)||t.pp-e.pp)}},class extends K{constructor(e){super(e),this.name="Worst score",this.id="worstscore"}run(e){F(e,Q(e.stars))}sort(e){return e.sort((e,t)=>(e.score||0)-(t.score||0)||e.pp-t.pp)}},class extends K{constructor(e){super(e),this.name="Oldest score",this.id="oldestscore"}run(e){F(e,Q(e.stars))}sort(e){return e.sort((e,t)=>(e.at||0)-(t.at||0)||e.pp-t.pp)}});class z{constructor(e,t,a,r=[]){this.elem=e,this.title=t,this.methods=a.map(e=>new e(this)),this.method=this.methods[0],this.elements=r,this.displayed=20,this.onScroll=this.onScroll.bind(this),e.innerHTML="";let n=l("list-header"),i=l("list-title",t);this.titleEl=i;let s=o("button","playlist","","Create a playlist");s.onclick=this.createPlaylist.bind(this),i.appendChild(s),n.appendChild(i);let d=l("method-wrapper"),c=l("method"),u=o("select");this.methods.forEach((e,t)=>{let a=((e,t)=>{let a=o("option");return a.textContent=e,a.value=t,a})(e.name,t);u.appendChild(a)}),u.onchange=()=>{this.changeMethod(this.methods[u.value])},c.appendChild(u);let p=o("button","unpause","","Keep going");p.addEventListener("click",()=>{this.updating||this.update()}),c.appendChild(p),d.appendChild(c),this.methods.forEach(e=>{let t=e.createOptionsMarkup();t&&d.appendChild(t)}),n.appendChild(d),e.appendChild(n),this.content=l("list-content"),this.content.addEventListener("scroll",this.onScroll),e.appendChild(this.content),this.update(),this.onScroll()}createPlaylist(){let e=+prompt("Number of items to include in the playlist",50);if(!e)return;let t=(new Date).toISOString().slice(0,10),a=this.elements.filter(e=>e.id).slice(0,e).map(e=>({hash:e.id,songName:e.name})),r={playlistTitle:this.title+" ("+t+")",playlistAuthor:"Peepee",image:"data:image/png;base64,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",songs:a},n=this.title.replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();c("data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r)),n+"-"+t+".bplist")}changeMethod(e){this.method!==e&&(this.method&&this.elem.classList.remove("method-"+this.method.id),this.content.scrollTop=0,this.displayed=20,this.method=e,this.method&&this.elem.classList.add("method-"+this.method.id),this.update(),this.onScroll())}onScroll(){this.content.scrollTop+this.content.clientHeight>this.content.scrollHeight-50&&this.displayMore()}displayMore(){this.displayed>=this.elements.length||(this.displayed+=20,this.refresh())}createMarkup(e){let t=l("element"),r=l("left"),c=l("pic");c.style.backgroundImage="url(https://scoresaber.com/imports/images/songs/"+e.id+".png)",r.appendChild(c);let u=l("name-group"),p=l("name-and-artist");p.title=e.name+" - "+e.artist,p.appendChild(o("span","name",e.name)),p.appendChild(o("span","sep")),p.appendChild(o("span","artist",e.artist)),u.appendChild(p),u.appendChild(l("mapper",e.mapper));let h=e.diff||"Easy",m=a[h]||{},g=l("difficulty-and-score");if(g.appendChild(o("span","difficulty "+(m.className||h.toLowerCase()),m.display||h)),e.score||0===e.score){let t=o("span","score-and-rank");if(t.appendChild(o("span","score",n(e.score,2))),e.at){let a=new Date(e.at);t.appendChild(o("span","at",s(a),(f=a).getFullYear()+"-"+i(f.getMonth()+1)+"-"+i(f.getDate())+" "+i(f.getHours())+":"+i(f.getMinutes())))}t.appendChild(o("span","sep")),t.appendChild(o("span","rank",e.rank.toLocaleString())),g.appendChild(t)}var f;u.appendChild(g),r.appendChild(u),t.appendChild(r);let y=l("middle");y.appendChild(l("pot-title","Potential")),e._potScore=l("pot-score"),y.appendChild(e._potScore);let A=l("pot-pp");e._potPP=o("span"),A.appendChild(e._potPP),e._potInc=o("span","increase",null,"Total (weighted) pp change"),A.appendChild(e._potInc),y.appendChild(A),t.appendChild(y);let C=l("right"),v=l("important");v.appendChild(l("star-difficulty",e.stars,"Star difficulty")),void 0!==e.upvotes&&v.appendChild(l("upvotes",e.upvotes,"Upvotes")),void 0!==e.downvotes&&v.appendChild(l("downvotes",e.downvotes,"Downvotes")),C.appendChild(v);let b=l("secondary");e.duration&&b.appendChild(l("duration",function(e){let t=e.duration/e.bpm,a=Math.floor(t);return a+":"+("0"+Math.round(60*(t-a))).slice(-2)}(e),"Duration")),b.appendChild(l("bpm",n(e.bpm,2),"BPM")),C.appendChild(b);let k=l("links");if(e.beatSaverKey){let t=o("button","bsr",null,"Copy !bsr request");t.addEventListener("click",()=>function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}("!bsr "+e.beatSaverKey)),k.appendChild(t)}e.download&&k.appendChild(d(e.download,"download",null,"Download map","_blank")),e.beatSaverKey&&(k.appendChild(d("beatsaver://"+e.beatSaverKey,"oneclick",null,"OneClick install")),k.appendChild(d("https://beatsaver.com/beatmap/"+e.beatSaverKey,"beatsaver",null,"Open on BeatSaver","_blank"))),k.appendChild(d("https://scoresaber.com/leaderboard/"+e.uid,"leaderboards",null,"ScoreSaber leaderboard","_blank")),C.appendChild(k),t.appendChild(C),e.markup=t}async update(){let e=this.elements,t=e.length;this.titleEl.title=t+" leaderboard"+(1===t?"":"s");let a=this.method,r=Date.now();this.elem.classList.remove("paused"),this.updating&&this.elem.classList.remove("loading"),this.updating=r,a.async&&this.elem.classList.add("loading"),await a.init(e),this.refresh();let n=()=>this.updating!==r;for(let t=0;t<e.length;t++){let r=await a.run(e[t],n);if(a.async){if(n())return;this.refresh()}if("PAUSE_UPDATE"===r){this.elem.classList.add("paused");break}}a.async?this.elem.classList.remove("loading"):this.refresh(),this.updating=!1}defaultSort(e){return e.sort((e,t)=>(t.estimateFull||0)-(e.estimateFull||0)||t.pp-e.pp)}refresh(){for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);let e=this.method.sort||this.defaultSort;this.elements=e(this.elements),this.elements.slice(0,this.displayed).forEach(e=>{e.markup||this.createMarkup(e),void 0===e.estimateScore&&F(e,0),e._potScore.textContent=n(e.estimateScore,2)+"%",e._potPP.textContent=n(e.estimatePP,2)+"pp",e._potInc.textContent=n(Math.max(e.estimateFull-O,0),2),this.content.appendChild(e.markup)})}}let Z=new z(document.querySelector(".list.unplayed"),"Not played",G),Y=new z(document.querySelector(".list.played"),"To improve",R),X=document.getElementById("last-update");async function _(e){if(e&&e.preventDefault&&e.preventDefault(),y.classList.contains("loading"))return;let t=A.value.match(/\d{5,}/);if(!t)return void r(y,"invalid");let a=t[0];C.textContent="Getting user infos...",y.classList.add("loading"),A.disabled=!0,E=Date.now();try{let e=await P;x=e.list.reduce((e,t)=>(e[t.uid]=t,e),{}),L=e.timestamp,X.textContent=new Date(L).toString();let t=await T(a,{useCache:location.search.includes("debug"),onProgress:e=>C.textContent="Getting scores page "+e+"..."});I=t.user,S=t.scores,O=B(0,0),w(I),V(),q(e,S),window.playerSongs=S,document.body.classList.add("step-results","user-"+a)}catch(e){console.error(e),r(y,"invalid")}A.disabled=!1,y.classList.remove("loading")}y.addEventListener("submit",_),A.addEventListener("paste",()=>setTimeout(_,0)),A.addEventListener("focus",()=>A.select()),document.getElementById("back").addEventListener("click",()=>{A.value="",document.body.classList.remove("step-results")}),document.getElementById("refresh").addEventListener("click",(async function(){if(!I||!I.id)return;document.body.classList.add("refreshing");try{let e=E;E=Date.now();let t=await async function(e,t){let a,r=1,n={};for(let i=!0;i;r++){let s=await m(e,r,2);1===r&&(a=D(e,s));let o=M(s);if(!o)break;let l=Math.min(...o.map(e=>e.at));o=o.map(e=>{let t=x[e.uid];return t&&Object.assign({},t,e)}).filter(e=>e),o.forEach(e=>n[e.uid]=e),l>=t?await u(200):i=!1}return{user:a,scores:n}}(I.id,e);I=t.user,Object.assign(S,t.scores),w(I),O=B(0,0),V()}catch(e){}let e=p("/ranked",{headers:{"If-Modified-Since":new Date(L).toUTCString()}});try{await e,P=e}catch(e){}q(await P,S),document.body.classList.remove("refreshing")})),document.getElementById("export-curve").addEventListener("click",()=>{let e=document.createElement("canvas");e.width=800,e.height=400,U(e.getContext("2d"),{background:!0,numPoints:500});let t=(I.name||"").replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();c(e.toDataURL(),t+"-score-curve.png")})}();
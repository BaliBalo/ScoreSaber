!async function(){const e={GN:.04,DA:.02,FS:.08,NF:-.5,NO:-.05,NB:-.1,SS:-.3,NA:-.3},t=[{at:0,value:0},{at:40,value:.08},{at:50,value:.15},{at:69,value:.25},{at:75,value:.425},{at:82,value:.56},{at:84.5,value:.63},{at:86,value:.72},{at:88,value:.766},{at:90,value:.815},{at:91,value:.85},{at:92,value:.885},{at:93,value:.92},{at:94,value:.974},{at:95,value:1.036},{at:100,value:1.1},{at:110,value:1.15},{at:114,value:1.2}],a={ExpertPlus:{className:"expert-plus",display:"Expert+"}};function n(e,t){e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}function i(e,t=0){return e.toFixed(t).replace(/\.?0*$/,"")}function r(e,t,a,n){let i=document.createElement(e);return null!=t&&(i.className=t),null!=a&&(i.textContent=a),null!=n&&(i.title=n),i}let l=r.bind(null,"div"),s=(e,t,a,n,i)=>{let l=r("a",t,a,n);return l.href=e,i&&(l.target=i),l};function o(e,t){let a=document.createElement("a");a.download=t,a.href=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}async function d(e){await new Promise(t=>setTimeout(t,e))}function c(...e){return fetch(...e).then(e=>e.json())}async function p(...e){return fetch(...e).then(e=>e.ok?e.text():Promise.reject()).then(e=>{if(-1===e.indexOf("<html"))throw new Error("not an HTML page: "+e);return(new DOMParser).parseFromString(e,"text/html")})}async function u(e,t,a=1,n=2){return p("/proxy/u/"+e+"?sort="+a+"&page="+(t||1)).catch(async i=>{if(n-- >0)return await d(1e3),u(e,t,a,n);throw i})}function h(t){return t?t.split(",").reduce((t,a)=>t+(e[a.trim()]||0),1):1}function m(e){if(!e)return null;let t=e.getAttribute("src");return t.match(/^https?:\/\//)||(t="https://scoresaber.com"+("/"===t[0]?"":"/")+t),t}WebFont.load({custom:{families:["NeonTubes"]}});let g=document.getElementById("user"),f=document.getElementById("profile"),A=document.getElementById("user-fetch-info"),y=[];try{let e=JSON.parse(localStorage.getItem("history"));Array.isArray(e)&&(y=e)}catch(e){}let C=document.querySelector(".history");function v(){C.innerHTML="",y.slice(0,5).forEach(e=>{if(!e||!e.avatar||null==e.rank||!e.name)return;let t=l("line");t.onclick=()=>{f.disabled||(f.value=e.id,G())};let a=l("avatar");a.style.backgroundImage="url("+e.avatar+")",t.appendChild(a),t.appendChild(l("rank",e.rank.toLocaleString())),t.appendChild(l("name",e.name)),C.appendChild(t)})}v();let b={},k={},w={},S=Date.now(),x=0,I=c("/ranked"),E=0;function L(e,t){let a=t.querySelector("h5.title"),n=a&&a.textContent.trim();if(!n)throw new Error("Invalid Profile");let i=t.querySelector(".avatar img"),r=a.querySelector("img"),l=t.querySelector("h5.title ~ ul"),s=l&&l.textContent||"",o=s.match(/#([\d,]+) /),d=s.match(/([\d,.]+)pp/),c={id:e,name:n,avatar:m(i),country:m(r),rank:o?+o[1].replace(/\D/g,""):0,pp:d?+d[1].replace(/[^\d.]/g,""):0};y=y.filter(e=>e&&e.id!==c.id),y.unshift(c),y=y.slice(0,5);try{localStorage.setItem("history",JSON.stringify(y))}catch(e){}return v(),c}function P(e){if(!e)return;let t=e.querySelector("table.ranking.songs tbody");if(!t)throw new Error("Error while parsing results page - maybe scoresaber is having issues?");return[...t.querySelectorAll("tr")].map(e=>{let t=e.querySelector('a[href*="/leaderboard/"]'),a=t&&t.href.match(/\/leaderboard\/(\d+)/);if(!a)return;let n=+a[1],i=e.querySelector(".ppValue"),r=i&&+i.textContent,l=e.querySelector(".rank"),s=l&&l.textContent.match(/#?([\d,]+)/),o=e.querySelector(".time"),d=Date.now();if(o){let e=(o.title||"").replace(/^.*(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2}).*$/,"$1T$2Z");d=+new Date(e)||d}let c=e.querySelector(".ppWeightedValue"),p=c&&c.textContent.match(/([\d.]+)/),u=e.querySelector(".scoreBottom"),m=u&&u.textContent.match(/([\d.]+)%/),g=m&&+m[1]||0,f=u&&u.textContent.match(/\(([^)]+)\)/),A=h(f&&f[1]);return{uid:n,rank:s&&+s[1].replace(/\D/g,"")||1/0,at:d,userPP:r,weighted:p&&+p[1]||0,score:g*A,modScore:g}}).filter(e=>e)}function O(e,t){H.elements=Object.values(t),K.elements=e.list.filter(e=>!Object.prototype.hasOwnProperty.call(t,e.uid)).map(e=>Object.assign({},e)),H.update(),K.update(),B()}function T(e,t){let a=Object.values(k).filter(t=>t.uid!==e).map(e=>e.userPP);t&&a.push(t),a.sort((e,t)=>t-e);let n=1;return a.reduce((e,t,a)=>e+t*(n*=a?.965:1),0)}function D(e,a){if(e.score&&e.score>=a)return e.estimateScore=e.score,e.estimatePP=e.userPP,void(e.estimateFull=E);e.estimateScore=a,e.estimatePP=e.pp*function(e){if(!e||e<=0)return 0;let a=t.findIndex(t=>t.at>=e);if(-1===a)return t[t.length-1].value;if(!a)return t[0].value;let n=t[a-1],i=t[a],r=(e-n.at)/(i.at-n.at);return n.value+(i.value-n.value)*r}(a),e.estimateFull=T(e.uid,e.estimatePP)}function M(e){let t=Date.now(),a=Object.values(k),n=Math.max(...a.map(e=>e.stars)),i=a.reduce((a,n)=>{let i=2*Math.abs(e-n.stars),r=e>n.stars?i*i*i:1,l=n.at||t,s=1/(1+i*(1+Math.max(t-l,0)/1296e6)*r);return a.weight+=s,a.sum+=n.score*s,a},{weight:0,sum:0}),r=i.weight?i.sum/i.weight:0;if(e>n){let t=2*Math.abs(e-n);r/=1+t*t}return r}let q=document.getElementById("score-est-curve").getContext("2d");function B(e,t){t=t||{};let a=(e=e||q).canvas;e.clearRect(0,0,a.width,a.height),t.background&&(e.fillStyle=!0===t.background?"#1e1f26":t.background,e.fillRect(0,0,a.width,a.height)),e.strokeStyle="white";let n=t.numPoints||100,i=t.maxStars||12,r=t.maxPercentage||1.12,l=t.marginX||34,s=t.marginY||20;e.fillStyle="white",e.font='12px Calibri,Candara,Segoe,"Segoe UI",Optima,Arial,sans-serif',e.textBaseline="middle",e.textAlign="right",[...Array(5)].forEach((t,n)=>{n+=1,e.fillText(20*n+"%",l-4,(a.height-s)*(1-n/5/r),l-4)}),e.textBaseline="top",e.textAlign="left",e.fillText("star diff",0,a.height-s+4),e.textAlign="center",[...Array(i-1)].forEach((t,n)=>{let r=n+1;e.fillText(r,l+(a.width-l)*r/i,a.height-s+4)}),e.strokeStyle="rgba(255, 255, 255, .1)",e.beginPath(),[...Array(11)].forEach((t,n)=>{n+=1;let i=(a.height-s)*(1-n/10/r);e.moveTo(l,i),e.lineTo(a.width,i)}),e.stroke(),e.strokeStyle="white",e.beginPath(),e.moveTo(l,0),e.lineTo(l,a.height-s),e.lineTo(a.width,a.height-s),e.stroke(),e.fillStyle="rgba(120, 10, 0, .9)",e.globalCompositeOperation="lighter",Object.values(k).forEach(t=>{let n=l+t.stars/i*(a.width-l),o=(a.height-s)*(1-t.score/100/r);e.fillRect(n-1,o-1,2,2)}),e.globalCompositeOperation="source-over",e.beginPath();for(let t=0;t<n;t++){let o=t/(n-1),d=M(o*i)/100,c=l+o*(a.width-l),p=(a.height-s)*(1-d/r);e.lineTo(c,p)}e.stroke()}let F={avatar:document.querySelector(".player .avatar"),flag:document.querySelector(".player .flag"),name:document.querySelector(".player .name"),rank:document.querySelector(".player .rank"),pp:document.querySelector(".player .pp"),best:document.querySelector(".player .stats .best"),median:document.querySelector(".player .stats .median")};function Q(){F.avatar.style.backgroundImage="url("+b.avatar+")",F.flag.style.backgroundImage="url("+b.country+")",F.name.textContent=b.name,F.name.href="https://scoresaber.com/u/"+b.id,F.rank.textContent=b.rank.toLocaleString(),F.pp.textContent=b.pp.toLocaleString();let e=Object.values(k).map(e=>e.rank).sort((e,t)=>e-t),t=e[~~(e.length/2)]||0,a=e[0]||0,n=e.findIndex(e=>e!==a);-1===n&&(n=e.length),F.best.textContent=a.toLocaleString(),F.best.title=n.toLocaleString()+" leaderboard"+(1===n?"":"s"),F.median.textContent=t.toLocaleString()}let U=0;class N{constructor(e){this.list=e,this.async=!1,this.name="???",this.id="unknown"}createOptionsMarkup(){}init(){}run(e){D(e,0)}}let V=[class extends N{constructor(e){super(e),this.name="Score est.",this.id="estimate"}run(e){D(e,M(e.stars))}},class extends N{constructor(e){super(e),this.async=!0,this.name="Score at rank",this.id="rank"}createOptionsMarkup(){let e=r("form","rank-form");e.addEventListener("submit",e=>e.preventDefault()),this.rankInput=r("input","rank-input"),this.rankInput.type="text",this.rankInput.placeholder=(b.rank||1).toLocaleString()+" (desired rank)",this.rankInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.rankInput);let t=r("button","rank-submit");return t.type="submit",e.appendChild(t),e}init(e){e.sort((e,t)=>t.stars-e.stars),this.rankInput.placeholder=(b.rank||1).toLocaleString()+" (desired rank)",this.rank=~~+this.rankInput.value.replace(/,/g,""),(!this.rank||this.rank<=0)&&(this.rank=b.rank||9999999),U=0}async run(e,t){let a=this.rank,n="scoreAtRank"+a,i=!1;if(!Object.prototype.hasOwnProperty.call(e,n)){let t=0,r=e.scores;"string"==typeof r&&(r=+r.replace(/,/g,"")||1/0),a<=r&&a<(+e.rank||1/0)&&(t=await async function e(t,a,n=2){if(!t||!a)return console.log("Invalid score at rank request",t,a),0;let i=Math.ceil(a/12),r=a-12*(i-1);try{let e=await p("/proxy/leaderboard/"+t+"?page="+(i||1));if(!e)return 0;let a=e.querySelector(".ranking tbody tr:nth-child("+r+")");if(!a)return 0;let n=a.querySelector(".percentage"),l=(n&&n.textContent||"").match(/[\d.]+/);if(!l)return 0;let s=a.querySelector(".mods"),o=h(s&&s.textContent),d=n&&n.querySelector("span[style*=tomato]");return l[0]*o*(d?110/115:1)}catch(i){return n-- >0?(await d(1e3),e(t,a,n)):(console.log("Error getting score at rank",i),0)}}(e.uid,a),U++,i=!0),e[n]=t}if(!t()){if(D(e,e[n]||0),U>=100)return"PAUSE_UPDATE";i&&await d(200)}}},class extends N{constructor(e){super(e),this.name="Fixed score",this.id="raw",this.score=94.333333}createOptionsMarkup(){let e=r("form","fixed-form");e.addEventListener("submit",e=>e.preventDefault()),this.fixedInput=r("input","fixed-input"),this.fixedInput.type="text",this.fixedInput.placeholder="94.3333%",this.fixedInput.maxLength=10,this.fixedInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.fixedInput);let t=r("button","fixed-submit");return t.type="submit",e.appendChild(t),e}init(){this.score=parseFloat(this.fixedInput.value.trim())||94.333333,this.score<=0&&(this.score=.01)}run(e){D(e,this.score)}}],j=V.concat(class extends N{constructor(e){super(e),this.name="Worst rank",this.id="worstrank"}run(e){D(e,M(e.stars))}sort(e){return e.sort((e,t)=>(t.rank||0)-(e.rank||0)||t.pp-e.pp)}},class extends N{constructor(e){super(e),this.name="Best rank",this.id="bestrank"}run(e){D(e,M(e.stars))}sort(e){return e.sort((e,t)=>(e.rank||0)-(t.rank||0)||t.pp-e.pp)}});class W{constructor(e,t,a,n=[]){this.elem=e,this.title=t,this.methods=a.map(e=>new e(this)),this.method=this.methods[0],this.elements=n,this.displayed=20,this.onScroll=this.onScroll.bind(this),e.innerHTML="";let i=l("list-header"),s=l("list-title",t);this.titleEl=s;let o=r("button","playlist","","Create a playlist");o.onclick=this.createPlaylist.bind(this),s.appendChild(o),i.appendChild(s);let d=l("method-wrapper"),c=l("method"),p=r("select");this.methods.forEach((e,t)=>{let a=((e,t)=>{let a=r("option");return a.textContent=e,a.value=t,a})(e.name,t);p.appendChild(a)}),p.onchange=()=>{this.changeMethod(this.methods[p.value])},c.appendChild(p);let u=r("button","unpause","","Keep going");u.addEventListener("click",()=>{this.updating||this.update()}),c.appendChild(u),d.appendChild(c),this.methods.forEach(e=>{let t=e.createOptionsMarkup();t&&d.appendChild(t)}),i.appendChild(d),e.appendChild(i),this.content=l("list-content"),this.content.addEventListener("scroll",this.onScroll),e.appendChild(this.content),this.update(),this.onScroll()}createPlaylist(){let e=+prompt("Number of items to include in the playlist",50);if(!e)return;let t=(new Date).toISOString().slice(0,10),a=this.elements.filter(e=>e.id).slice(0,e).map(e=>({hash:e.id,songName:e.name})),n={playlistTitle:this.title+" ("+t+")",playlistAuthor:"Peepee",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAF7klEQVR4Ae2dT4hbVRTGz315SToztjh1dJKM/6hFRLoQdakuuihF0O5F6KoIIm50IbhSBHEjbnUjCi61UCnajVCo4kIpFjcK/qFY3igt7YxJk5nJy5WALWTMnHdefTdz7z3fQGlfzvdOzvm+3/QlaZox5OBreXn5QJIkvzhorbnlC1mWfVC1AUnVDdEvLAcAQFh5VT4tAKjc0rAaAoCw8qp8WgBQuaVhNQQAYeVV+bQAoHJLw2oIAMLKq/JpAUDllobV0EjHbbVarxpjnpXo7+mk5o3X7nhCooVG5sDJ091fPz/Ty2VqWs+y7HGJNpWIxhpjzINE9KRE32wka0cPL0ik0Agd+O78xiIRjX8Vfhlj1gpF/wpwCZA6FanODQCGRpH6tWtr1Wr2uos7dwOAi0mV9zSGrAsLAIALVwPqCQACCsvFqADAhasB9QQAAYXlYlQA4MLVgHoCgIDCcjFqurS01JY0vreV76kldn2bdupTk4Mrpp8PulNftTImoaRe39YGh0UOtO6q1Q/cJ/atnufLh4p6juum3W5PDXH7yW+eWKNjT8lei0ibdVpcuXN7Cxz/HwcWWkTpnKjD5qal+x/9TaTFJUBkU7wiABBvtqLNAIDIpnhFACDebEWbAQCRTfGKAEC82Yo2AwAim+IVAYB4sxVtBgBENsUrAgDxZivaTPyuYFG3GYo251+iUW1lhvcou6tm7z0yoz9lYg9UwQIwbB6mvPawBxZOjtDofxgUALgETOan7ggAqIt8cmEAMOmHuiMAoC7yyYUBwKQf6o68exZgzd7xG5UKg7ACTWETCMg7ALr7zxGZZmE09cFnNH/teKFupgJTp97iF6K7rG+comb3LZHWpcg7AOTLbpH5z3tU5We7UTbImn2i1pbmRTrXIjwGcO2w5/0BgOcBuR4PALh22PP+AMDzgFyPBwBcO+x5/2CfBYwfbY/S8edWFXzZASX5xQIRX7ZmgWyyxIvGVSP+r1vFvWak8A6AhatPE1HxX0z92z+iXvNUoU3J8CdauHasUMcJho0jNNj7Nie5WasPPqV04/TN453+kIz+2qk009u9AyAZXRIa4OfnUCWji5RufSPcYfdlxd9quz8jJnDoAABwaG4IrQFACCk5nBEAODQ3hNYAIISUHM4IAByaG0Jr754G+mnakAwNZKPZTZnOE1WwAMytv0iWGoU22vQh6i0WvzDDNTL2b7rt8iOcJNhasAAkw59Fpg9rHRrVHhBpdxIZK/74/Z1aeHs7HgN4G81sBgMAs/HZ23sBAN5GM5vBAMBsfPb2XgCAt9HMZrBgnwWI7Rl1Kcl/F8unCf17+/m0KW/ttugBGP/bfHr16K25o+AsXAIUhMytCAA4dxTUAICCkLkVAQDnjoIaAFAQMrciAODcUVADAApC5lYEAJw7CmoAQEHI3IoAgHNHQQ0AKAiZWxEAcO4oqAEABSFzKwIAzh0FNQCgIGRuRQDAuaOgBgAUhMytCAA4dxTUAICCkLkVAQDnjoIaAFAQMrciAODcUVADAApC5lYEAJw7CmoAQEHI3IoAgHNHQQ0AKAiZWxEAcO4oqAEABSFzKwIAzh0FNQCgIGRuRQDAuaOgBgAUhMytCAA4dxTUAICCkLkVAQDnjoIaAFAQMrciAODcUVADAApC5lYEAJw7CmoAQEHI3IrjTwp9hRPcqJ08O/fcV983H7txzP1+6OCIXn5+nZOgVsKBWqNJFy5coS+/nROdlec2J6J3JOI0y7J3JUKi9goRiQC4srZFJ56J96dsyPyqUtWlr88N6P1P9kmb9rMse10ixiVA4lLEGgAQcbiS1QCAxKWINQAg4nAlqwEAiUsRawBAxOFKVgMAEpci1gCAiMOVrFbmZwZdIqIfJE17fdp/9vyeuyVaaGQOZJfTP4joR5margt1ZKTCMrpOp3PEWnumzDnQ8g5Ya4+vrq5+zKvKV3EJKO9ZVGcAgKjiLL8MACjvWVRnAICo4iy/DAAo71lUZwCAqOIsvwwAKO9ZVGcAgKjiLL/MP1IivdJqKho+AAAAAElFTkSuQmCC",songs:a},i=this.title.replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();o("data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),i+"-"+t+".bplist")}changeMethod(e){this.method!==e&&(this.method&&this.elem.classList.remove("method-"+this.method.id),this.content.scrollTop=0,this.displayed=20,this.method=e,this.method&&this.elem.classList.add("method-"+this.method.id),this.update(),this.onScroll())}onScroll(){this.content.scrollTop+this.content.clientHeight>this.content.scrollHeight-50&&this.displayMore()}displayMore(){this.displayed>=this.elements.length||(this.displayed+=20,this.refresh())}createMarkup(e){let t=l("element"),n=l("left"),o=l("pic");o.style.backgroundImage="url(https://scoresaber.com/imports/images/songs/"+e.id+".png)",n.appendChild(o);let d=l("name-group"),c=l("name-and-artist");c.title=e.name+" - "+e.artist,c.appendChild(r("span","name",e.name)),c.appendChild(r("span","sep")),c.appendChild(r("span","artist",e.artist)),d.appendChild(c),d.appendChild(l("mapper",e.mapper));let p=e.diff||"Easy",u=a[p]||{},h=l("difficulty-and-score");if(h.appendChild(r("span","difficulty "+(u.className||p.toLowerCase()),u.display||p)),e.score||0===e.score){let t=r("span","score-and-rank");t.appendChild(r("span","score",i(e.score,2))),t.appendChild(r("span","sep")),t.appendChild(r("span","rank",e.rank.toLocaleString())),h.appendChild(t)}d.appendChild(h),n.appendChild(d),t.appendChild(n);let m=l("middle");m.appendChild(l("pot-title","Potential")),e._potScore=l("pot-score"),m.appendChild(e._potScore);let g=l("pot-pp");e._potPP=r("span"),g.appendChild(e._potPP),e._potInc=r("span","increase",null,"Total (weighted) pp change"),g.appendChild(e._potInc),m.appendChild(g),t.appendChild(m);let f=l("right"),A=l("important");A.appendChild(l("star-difficulty",e.stars,"Star difficulty")),void 0!==e.upvotes&&A.appendChild(l("upvotes",e.upvotes,"Upvotes")),void 0!==e.downvotes&&A.appendChild(l("downvotes",e.downvotes,"Downvotes")),f.appendChild(A);let y=l("secondary");e.duration&&y.appendChild(l("duration",function(e){let t=e.duration/e.bpm,a=Math.floor(t);return a+":"+("0"+Math.round(60*(t-a))).slice(-2)}(e),"Duration")),y.appendChild(l("bpm",i(e.bpm,2),"BPM")),f.appendChild(y);let C=l("links");if(e.beatSaverKey){let t=r("button","bsr",null,"Copy !bsr request");t.addEventListener("click",()=>function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}("!bsr "+e.beatSaverKey)),C.appendChild(t)}if(e.download){let t=s(e.download,"download",null,"Download map","_blank");t.addEventListener("click",t=>{if(0!==t.button)return;t.preventDefault();let a=document.createElement("iframe");a.style.display="none",document.body.appendChild(a);let n=()=>{window.removeEventListener("blur",r),document.body.removeChild(a)},i=setTimeout((function(){n(),location.href=e.download}),500),r=()=>{clearTimeout(i),n()};window.addEventListener("blur",r),a.contentWindow.location.href="beatsaver://"+e.beatSaverKey}),C.appendChild(t)}e.beatSaverKey&&C.appendChild(s("https://beatsaver.com/beatmap/"+e.beatSaverKey,"beatsaver",null,"Open on BeatSaver","_blank")),C.appendChild(s("https://scoresaber.com/leaderboard/"+e.uid,"leaderboards",null,"ScoreSaber leaderboard","_blank")),f.appendChild(C),t.appendChild(f),e.markup=t}async update(){let e=this.elements,t=e.length;this.titleEl.title=t+" leaderboard"+(1===t?"":"s");let a=this.method,n=Date.now();this.elem.classList.remove("paused"),this.updating&&this.elem.classList.remove("loading"),this.updating=n,a.async&&this.elem.classList.add("loading"),await a.init(e),this.refresh();let i=()=>this.updating!==n;for(let t=0;t<e.length;t++){let n=await a.run(e[t],i);if(a.async){if(i())return;this.refresh()}if("PAUSE_UPDATE"===n){this.elem.classList.add("paused");break}}a.async?this.elem.classList.remove("loading"):this.refresh(),this.updating=!1}defaultSort(e){return e.sort((e,t)=>(t.estimateFull||0)-(e.estimateFull||0)||t.pp-e.pp)}refresh(){for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);let e=this.method.sort||this.defaultSort;this.elements=e(this.elements),this.elements.slice(0,this.displayed).forEach(e=>{e.markup||this.createMarkup(e),void 0===e.estimateScore&&D(e,0),e._potScore.textContent=i(e.estimateScore,2)+"%",e._potPP.textContent=i(e.estimatePP,2)+"pp",e._potInc.textContent=i(Math.max(e.estimateFull-E,0),2),this.content.appendChild(e.markup)})}}let K=new W(document.querySelector(".list.unplayed"),"Not played",V),H=new W(document.querySelector(".list.played"),"To improve",j),J=document.getElementById("last-update");async function G(e){if(e&&e.preventDefault&&e.preventDefault(),g.classList.contains("loading"))return;let t=f.value.match(/\d{5,}/);if(!t)return void n(g,"invalid");let a=t[0];A.textContent="Getting user infos...",g.classList.add("loading"),f.disabled=!0,S=Date.now();try{let e=await I;w=e.list.reduce((e,t)=>(e[t.uid]=t,e),{}),x=e.timestamp,J.textContent=new Date(x).toString(),k={},await async function e(t,a=1){A.textContent="Getting scores page "+a+"...";let n=await u(t,a);1===a&&(b=L(t,n));let i=P(n);if(i){i=i.filter(e=>e.userPP);let n=i.length;if(i=i.map(e=>{let t=w[e.uid];if(t)return Object.assign({},t,e)}).filter(e=>e),i.forEach(e=>k[e.uid]=e),8===n)return await d(200),e(t,a+1)}}(a),E=T(0,0),Q(),O(e,k),window.playerSongs=k,document.body.classList.add("step-results","user-"+a)}catch(e){console.log(e),n(g,"invalid")}f.disabled=!1,g.classList.remove("loading")}g.addEventListener("submit",G),f.addEventListener("paste",()=>setTimeout(G,0)),f.addEventListener("focus",()=>f.select()),document.getElementById("back").addEventListener("click",()=>{f.value="",document.body.classList.remove("step-results")}),document.getElementById("refresh").addEventListener("click",(async function(){if(!b||!b.id)return;document.body.classList.add("refreshing");try{let e=S;S=Date.now(),await async function e(t,a,n=1){let i=await u(t,n,2);1===n&&(b=L(t,i));let r=P(i);if(r){let i=Math.min(...r.map(e=>e.at));if(r=r.map(e=>{let t=w[e.uid];if(t)return Object.assign({},t,e)}).filter(e=>e),r.forEach(e=>k[e.uid]=e),i>=a)return e(t,a,n+1)}}(b.id,e)}catch(e){}E=T(0,0),Q();let e=c("/ranked",{headers:{"If-Modified-Since":new Date(x).toUTCString()}});try{await e,I=e}catch(e){}O(await I,k),document.body.classList.remove("refreshing")})),document.getElementById("export-curve").addEventListener("click",()=>{let e=document.createElement("canvas");e.width=800,e.height=400,B(e.getContext("2d"),{background:!0,numPoints:500});let t=(b.name||"").replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();o(e.toDataURL(),t+"-score-curve.png")})}();
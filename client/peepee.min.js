!async function(){document.body.classList.add("js-loaded");const e="PAUSE_UPDATE",t={GN:.04,DA:.02,FS:.08,NF:-.5,NO:-.05,NB:-.1,SS:-.3,NA:-.3},n=[{at:0,value:0},{at:45,value:.015},{at:50,value:.03},{at:55,value:.06},{at:60,value:.105},{at:65,value:.16},{at:68,value:.24},{at:70,value:.285},{at:80,value:.563},{at:84,value:.695},{at:88,value:.826},{at:94.5,value:1.015},{at:95,value:1.046},{at:100,value:1.12},{at:110,value:1.18},{at:114,value:1.25}],i={ExpertPlus:{className:"expert-plus",display:"Expert+"}};function a(e,t){e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}function r(e,t=0){return e.toFixed(t).replace(/\.?0*$/,"")}function s(e,t,n){return e<t?t:e>n?n:e}function l(e,t,n){return t+e*(n-t)}function o(e,t,n){return s((e-t)/(n-t),0,1)}function c(e){return("0"+e).slice(-2)}function d(e,t){let n=e.getFullYear()+"-"+c(e.getMonth()+1)+"-"+c(e.getDate()),i=c(e.getHours())+":"+c(e.getMinutes());return t&&(i+=":"+c(e.getSeconds())),n+" "+i}const u=function(){const e=6e4,t=36e5,n=24*t;let i=(e,t)=>~~(e/t),a=(e,t)=>e+" "+t+(1!==e&&-1!==e?"s":"");return r=>function(r,s){let l=s-r,o=Math.abs(l);if(o<e)return a(i(l,1e3),"second");if(o<t)return a(i(l,e),"minute");if(o<n)return a(i(l,t),"hour");if(o<2592e6)return a(i(l,n),"day");let c=function(e,t){let n=t.getFullYear()-e.getFullYear();return t.getMonth()-e.getMonth()+12*n}(r,s);return Math.abs(c)<12?a(c,"month"):a(~~(c/12),"year")}(r,new Date)+" ago"}();function p(e,t,n,i){let a=document.createElement(e);return null!=t&&(a.className=t),null!=n&&a.append(...Array.isArray(n)?n:[n]),null!=i&&(a.title=i),a}let h=p.bind(null,"div"),m=p.bind(null,"span"),f=(e,t,n)=>{let i=p("input",e);return t&&(i.value=t),n&&(i.placeholder=n),i},g=(e,t)=>{let n=p("option");return n.textContent=e,n.value=t,n},y=(e,t,n,i,a)=>{let r=p("a",t,n,i);return r.href=e,a&&(r.target=a),r};async function v(e){await new Promise((t=>setTimeout(t,e)))}async function b(...e){return fetch(...e).then((e=>e.ok?e.text():Promise.reject())).then((e=>{if(-1===e.indexOf("<html"))throw new Error("not an HTML page: "+e);return(new DOMParser).parseFromString(e,"text/html")}))}async function C(e,t,n=1,i=2){return b("/proxy/u/"+e+"?sort="+n+"&page="+(t||1)).catch((async a=>{if(i-- >0)return await v(1e3),C(e,t,n,i);throw a}))}function A(e){let t;return e&&(t={headers:{"If-Modified-Since":e.toUTCString()}}),function(...e){return fetch(...e).then((e=>e.json()))}("/ranked",t).then((e=>(function(e){R=e.timestamp;let t=new Date(R);se.textContent=u(t)+" ("+d(t,!0)+")",se.title=t.toString(),se.classList.remove("unknown")}(e),e)))}function k(e){return e?e.split(",").reduce(((e,n)=>e+(t[n.trim()]||0)),1):1}async function w(e,t,n=2){if(!e||!t)return console.log("Invalid score at rank request",e,t),0;let i=Math.ceil(t/12),a=t-12*(i-1);try{let t=await b("/proxy/leaderboard/"+e+"?page="+(i||1));if(!t)return 0;let n=t.querySelector(".ranking tbody tr:nth-child("+a+")");if(!n)return 0;let r=n.querySelector(".percentage"),s=(r&&r.textContent||"").match(/[\d.]+/);if(!s)return 0;let l=n.querySelector(".mods"),o=k(l&&l.textContent),c=r&&r.querySelector("span[style*=tomato]");return s[0]*o*(c?110/115:1)}catch(i){return n-- >0?(await v(1e3),w(e,t,n)):(console.log("Error getting score at rank",i),0)}}async function I(e,t=2){if(!e)return console.log("Invalid player at rank request",e),null;let n=Math.ceil(e/50),i=e-50*(n-1);try{let e=await b("/proxy/global/"+(n||1));if(!e)return null;let t=e.querySelector(".ranking tbody tr:nth-child("+i+")");if(!t)return null;let a=t.querySelector(".player a"),r=(a&&a.href||"").match(/\/u\/(\d+)/);return r?r[1]:null}catch(n){return t-- >0?(await v(1e3),I(e,t)):(console.log("Error getting player at rank",n),null)}}function x(e,t){if(!t.length||"number"!=typeof e||Number.isNaN(e))return 0;let n=t.findIndex((t=>t.at>=e));if(-1===n)return t[t.length-1].value;if(!n)return t[0].value;let i=t[n-1],a=t[n],r=(e-i.at)/(a.at-i.at);return i.value+(a.value-i.value)*r}function S(e){if(!e)return null;let t=e.getAttribute("src");return t.match(/^https?:\/\//)||(t="https://scoresaber.com"+("/"===t[0]?"":"/")+t),t}try{WebFont.load({custom:{families:["NeonTubes"]}})}catch(e){}let E=document.getElementById("user"),L=document.getElementById("profile"),P=document.getElementById("user-fetch-info"),T=[];try{let e=JSON.parse(localStorage.getItem("history"));Array.isArray(e)&&(T=e)}catch(e){}let O=document.querySelector(".history");function M(){O.innerHTML="",T.slice(0,5).forEach((e=>{if(!e||!e.avatar||null==e.rank||!e.name)return;let t=h("line");t.onclick=()=>{L.disabled||(L.value=e.id,be())};let n=h("avatar");n.style.backgroundImage="url("+e.avatar+")",t.appendChild(n),t.appendChild(h("rank",e.rank.toLocaleString())),t.appendChild(h("name",e.name)),O.appendChild(t)}))}function N(e){T=T.filter((t=>t&&t.id!==e.id)),T.unshift(e),T=T.slice(0,5);try{localStorage.setItem("history",JSON.stringify(T))}catch(e){}M()}M();let D={};async function F(e){D=e;try{let t=JSON.stringify(e,((e,t)=>Math.abs(t)===1/0?t+"":t));localStorage.setItem("peepee-filters",t)}catch(e){}ve.refresh(),ye.refresh()}function B(e){let t=m(),n=getComputedStyle(e);Object.assign(t.style,{position:"absolute",top:"-99px",left:"-99px",height:"0",whiteSpace:"pre",overflow:"hidden",visibility:"hidden",font:n.font,letterSpacing:n.letterSpacing,padding:n.padding});let i=()=>{t.textContent=e.value||e.placeholder||" ",e.style.width=t.clientWidth+1+"px"};return document.body.appendChild(t),e.addEventListener("input",i),i(),{check:i,stop:()=>{e.removeEventListener("input",i),document.body.removeChild(t)}}}async function q(e={}){let t;(e=Object.assign({},e)).hiddenMaps&&(e.hiddenMaps=e.hiddenMaps.slice());let n=new Promise((e=>t=e)),i=[],a=!1,r=e=>{a||(a=!0,i.forEach((e=>e.stop())),document.body.removeChild(s)),t(e)},s=h("filters-modal"),l=h("content"),o=p("h2",null,"FILTERS"),c=h("buttons"),d=p("button","cancel","Cancel"),u=p("button","ok","OK"),m=h("scroller"),y=f(null,e.scoreFrom),v=f(null,e.scoreTo),b=h("filter score",["Only show maps if the potential score is between ",y,"% and ",v,"%"]),C=f(null,e.starsFrom),A=f(null,e.starsTo),k=h("filter stars",["Only show maps if their ★ difficulty is between ",C," and ",A]),w=p("select");w.size=6,w.multiple=!0,(e.hiddenMaps||[]).forEach((e=>{let t=J[e];if(!t)return;let n=t.name+" - "+t.artist+" ("+t.mapper+") | "+t.diff;w.append(g(n,e))}));let I=p("button",null,"Unhide selected");I.disabled=!0;let x=h("filter hidden-maps",["Hide these specific maps (right click on a map to add it to this list):",w,I]),S=()=>{y.value=+y.value||0,v.value=!v.value||isNaN(+v.value)?"Infinity":+v.value,C.value=+C.value||0,A.value=!A.value||isNaN(+A.value)?"Infinity":+A.value,i.forEach((e=>e.check()))};return[y,v,C,A].forEach((e=>e.addEventListener("change",S))),S(),i.push(...[y,v,C,A].map(B)),w.addEventListener("change",(()=>{I.disabled=!w.selectedOptions.length})),I.addEventListener("click",(()=>{let e=w.selectedIndex;[...w.selectedOptions].forEach((e=>w.removeChild(e))),w.selectedIndex=Math.min(e,w.length-1)})),u.addEventListener("click",(()=>{S(),r({scoreFrom:+y.value,scoreTo:+v.value,starsFrom:+C.value,starsTo:+A.value,hiddenMaps:[...w.options].map((e=>+e.value))})})),d.addEventListener("click",(()=>r(null))),s.addEventListener("click",(e=>{l.contains(e.target)||r(null)})),m.append(b,k,x),c.append(d,u),l.append(o,m,c),s.append(l),document.body.append(s),n}!function(){D={scoreFrom:0,scoreTo:1/0,starsFrom:0,starsTo:1/0,hiddenMaps:[]};try{let e=JSON.parse(localStorage.getItem("peepee-filters"),((e,t)=>"Infinity"===t||"-Infinity"===t?+t:t));Object.assign(D,e),D.scoreFrom=+D.scoreFrom||0,D.scoreTo=isNaN(+D.scoreTo)?1/0:+D.scoreTo,D.starsFrom=+D.starsFrom||0,D.starsTo=isNaN(+D.starsTo)?1/0:+D.starsTo,Array.isArray(D.hiddenMaps)||(D.hiddenMaps=[])}catch(e){}}();let U=[];async function j(e=[]){let t;e=JSON.parse(JSON.stringify(e));let n=new Promise((e=>t=e)),i=!1,a=e=>{i||(i=!0,window.removeEventListener("resize",M),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",O),document.body.removeChild(s)),t(e)},s=h("custom-curve-modal"),c=h("content"),d=p("h2",null,"CUSTOM CURVE EDITOR"),u=h("buttons"),f=p("button","cancel","Cancel"),g=p("button","ok","OK"),y=h("scroller"),v=h("instructions","Left click to add or move points, right click to remove points"),b=h("editor"),C=p("canvas","preview"),A=C.getContext("2d"),k=h("points"),w=1.12,I=null,x=!1,S=e=>({x:l(e.at/15,34,C.width),y:l(e.value/w,C.height-20,0)}),E=e=>({at:15*o(e.x,34,C.width),value:w*o(e.y,C.height-20,0)}),L=()=>{if(re(A,{numPoints:0,marginX:34,marginY:20,maxPercentage:w,maxStars:15,playerSongsColor:"rgbs(136, 238, 255, .7)"}),e.length){A.strokeStyle="rgba(250, 120, 20, 1)",A.lineWidth=2,A.beginPath();let t=S({at:0,value:e[0].value});A.moveTo(t.x,t.y),e.forEach((e=>{let t=S(e);A.lineTo(t.x,t.y)}));let n=S({at:15,value:e[e.length-1].value});A.lineTo(n.x,n.y),A.stroke(),A.fillStyle="rgba(20, 250, 120, 1)",A.strokeStyle="rgba(20, 250, 120, 1)",e.forEach((e=>{let t=S(e);A.fillRect(t.x-3,t.y-3,6,6),e===I&&(A.beginPath(),A.arc(t.x,t.y,8,0,2*Math.PI),A.stroke())})),A.lineWidth=1}},P=()=>{e.sort(((e,t)=>e.at-t.at)),k.innerHTML="",e.forEach((e=>{let t=h("point"),n=h("at",[m("label","At: "),m("value",r(e.at,2)+"★")]),i=h("score",[m("label","Score: "),m("value",r(100*e.value,2)+"%")]);t.append(n,i),k.append(t)}))},T=t=>{if(!e.length)return;let n=C.getBoundingClientRect(),i=t.clientX-n.left,a=t.clientY-n.top;if(x){t.preventDefault();let e=E({x:i,y:a});return Object.assign(I,e),P(),void L()}let r=e.map((e=>{let t=S(e),n=i-t.x,r=a-t.y;return{point:e,d:n*n+r*r}}));r.sort(((e,t)=>e.d-t.d));let s=r[0].d<81?r[0].point:null;I!==s&&(I=s,L())};document.addEventListener("mousemove",T),C.addEventListener("mousedown",(t=>{if(t.preventDefault(),2===t.button)return e=e.filter((e=>e!==I)),I=null,P(),void L();if(!I){let n=E({x:t.offsetX,y:t.offsetY});e.push(n),I=n,P(),L()}x=!0})),C.addEventListener("contextmenu",(e=>e.preventDefault()));let O=()=>{x=!1};document.addEventListener("mouseup",O);let M=()=>{C.width=C.clientWidth,C.height=C.clientHeight,L()};return window.addEventListener("resize",M),g.addEventListener("click",(()=>a(e))),f.addEventListener("click",(()=>a(null))),s.addEventListener("click",(e=>{c.contains(e.target)||a(null)})),b.append(C,k),y.append(v,b),u.append(f,g),c.append(d,y,u),s.append(c),document.body.append(s),P(),M(),n}function H(e,t,n){let i=[];return n&&i.push("t="+encodeURIComponent(n)),i.push("i="+encodeURIComponent(e.map((e=>e.uid)).join("."))),"/custom-playlist/"+(t||"playlist.bplist")+"?"+i.join("&")}async function K(e,t={}){let n,i=new Promise((e=>n=e)),a=!1,l=e=>{(()=>{if(!a){a=!0;try{w.stop(),S.stop()}catch(e){}document.body.removeChild(o)}})(),n(e)},o=h("playlist-modal"),c=h("content"),d=p("h2",null,"CREATE A PLAYLIST"),u=h("buttons"),g=p("button","done","Done"),v=y("#","button file",".bplist"),b=y("#","button oneclick","OneClick™"),C=h("scroller"),A=t.filename||"playlist.bplist";v.download=A;let k=f(null,"",50);k.type="number",k.min=1,k.max=e.length;let w=B(k),I=h("line count",["Number of items from the top to include in the playlist: ",k]),x=f(null,"",1);x.type="number",x.min=1,x.max=e.length;let S=B(x),E=h("line offset",["Starting from item number: ",x]),L=m(null,"selection"),P=m(null,"0pp"),T=h("line pp",["Estimated PP gain for ",L,": ",P]),O=h("playlist warning",["Warning: too many maps - OneClick™ will likely not work"]),M=()=>{let n=x.value.trim(),i=s(!n||Number.isNaN(+n)?1:Math.floor(n),1,e.length)-1,a=k.value.trim(),l=s(!a||Number.isNaN(+a)?50:Math.floor(a),1,e.length),o=e.slice(i,i+l),c=o.filter(((e,t,n)=>e.id&&n.findIndex((t=>t.id===e.id))===t)),d="";if(0===i){d=(o.length===e.length?"all":"top")+" "+o.length+" leaderboard"+(1!==o.length?"s":"")}else if(1===o.length)d="leaderboard at position "+(i+1);else{d="leaderboards from "+(i+1)+" to "+(i+o.length)+", inclusive"}c.length!==o.length&&(d+=" (from "+c.length+" unique song"+(1!==c.length?"s":"")+")"),L.textContent=d;let u=ee(o.map((e=>e.uid)),o.map((e=>e.estimatePP||0)));P.textContent="+"+r(Math.max(u-G,0),2)+"pp",v.href=function(e,t){let n=e.map((e=>({hash:e.id,songName:e.name,difficulties:[{characteristic:"Standard",name:e.diff}]}))),i={playlistTitle:t,playlistAuthor:"Peepee",image:"data:image/png;base64,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",songs:n};return"data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i))}(o,t.title),v.download=A,b.href=H(o,A,t.title),b.href="bsplaylist://playlist/"+encodeURIComponent(b.href);let p=b.href.length>7500;O.style.display=p?"block":"none"};return k.addEventListener("input",M),x.addEventListener("input",M),M(),g.addEventListener("click",(()=>l(null))),o.addEventListener("click",(e=>{c.contains(e.target)||l(null)})),u.append(v,b,g),C.append(I,E,T,O),c.append(d,C,u),o.append(c),document.body.append(o),k.focus(),i}!function(){try{let e=JSON.parse(localStorage.getItem("peepee-custom-curve"));Array.isArray(e)&&(U=e)}catch(e){}}();let Q={},W={},J={},V=Date.now(),R=0,z=A(),G=0;function Y(e,t){let n=t.querySelector("h5.title"),i=n&&n.textContent.trim();if(!i)throw new Error("Invalid Profile");let a=t.querySelector(".avatar img"),r=n.querySelector("img"),s=t.querySelector("h5.title ~ ul"),l=s&&s.textContent||"",o=l.match(/#([\d,]+) /),c=l.match(/([\d,.]+)pp/);return{id:e,name:i,avatar:S(a),country:S(r),rank:o?+o[1].replace(/\D/g,""):0,pp:c?+c[1].replace(/[^\d.]/g,""):0}}function Z(e){if(!e)return;let t=e.querySelector("table.ranking.songs tbody");if(!t)throw new Error("Error while parsing results page - maybe scoresaber is having issues?");return[...t.querySelectorAll("tr")].map((e=>{let t=e.querySelector('a[href*="/leaderboard/"]'),n=t&&t.href.match(/\/leaderboard\/(\d+)/);if(!n)return;let i=+n[1],a=e.querySelector(".ppValue"),r=a&&+a.textContent,s=e.querySelector(".rank"),l=s&&s.textContent.match(/#?([\d,]+)/),o=e.querySelector(".time"),c=Date.now();if(o){let e=(o.title||"").replace(/^.*(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2}).*$/,"$1T$2Z");c=+new Date(e)||c}let d=e.querySelector(".ppWeightedValue"),u=d&&d.textContent.match(/([\d.]+)/),p=e.querySelector(".scoreBottom"),h=p&&p.textContent.match(/([\d.]+)%/),m=h&&+h[1]||0,f=p&&p.textContent.match(/\(([^)]+)\)/),g=k(f&&f[1]);return{uid:i,rank:l&&+l[1].replace(/\D/g,"")||1/0,at:c,userPP:r,weighted:u&&+u[1]||0,score:m*g,modScore:m}})).filter((e=>e))}function X(e){let t=J[e.uid];return t&&Object.assign({},t,e)}async function _(e,t){if(!e)throw new Error("No user ID specified");if((t=t||{}).useCache)try{let t=JSON.parse(localStorage.getItem("cached-"+e));if(t)return t}catch(e){}let n,i=1,a=[],r={};for(let s=!0;s;i++){"function"==typeof t.onProgress&&t.onProgress(i);let l=await C(e,i);1===i&&(n=Y(e,l),"function"==typeof t.onUserInfo&&t.onUserInfo(n));let o=Z(l);if(!o)break;o=o.filter((e=>e.userPP)),a.push(...o);let c=o.length;o=o.map(X).filter((e=>e)),o.forEach((e=>r[e.uid]=e)),8===c?await v(200):s=!1}if(t.useCache)try{localStorage.setItem("cached-"+e,JSON.stringify({user:n,scores:r}))}catch(e){}return{user:n,scores:r,rawScores:a}}function $(e,t){ve.elements=Object.values(t),ye.elements=e.list.filter((e=>!Object.prototype.hasOwnProperty.call(t,e.uid))).map((e=>Object.assign({},e))),ve.update(),ye.update(),re(),ie.parentElement.classList.add("show")}function ee(e,t){Array.isArray(e)||(e=e?[e]:[]);let n=Object.values(W);e.length&&(n=n.filter((t=>!e.includes(t.uid))));let i=n.map((e=>e.userPP)).concat(t).sort(((e,t)=>t-e)),a=1;return i.reduce(((e,t,n)=>e+t*(a*=n?.965:1)),0)}function te(e,t){return e.score&&e.score>=t?(e.estimateScore=e.score,e.estimatePP=e.userPP,void(e.estimateFull=G)):t?(e.estimateScore=t,e.estimatePP=e.pp*x(t,n),void(e.estimateFull=ee(e.uid,e.estimatePP))):(e.estimateScore=0,e.estimatePP=0,void(e.estimateFull=G))}function ne(e){let t=Date.now(),n=Object.values(W),i=Math.max(...n.map((e=>e.stars))),a=n.reduce(((n,i)=>{let a=2*Math.abs(e-i.stars),r=e>i.stars?a*a*a:1,s=i.at||t,l=1/(1+a*(1+Math.max(t-s,0)/1296e6)*r);return n.weight+=l,n.sum+=i.score*l,n}),{weight:0,sum:0}),r=a.weight?a.sum/a.weight:0;if(e>i){let t=2*Math.abs(e-i);r/=1+t*t}return r}let ie=document.getElementById("score-est-curve"),ae=ie.getContext("2d");function re(e,t){t=t||{};let n=(e=e||ae).canvas;e.clearRect(0,0,n.width,n.height),t.background&&(e.fillStyle=!0===t.background?"#1e1f26":t.background,e.fillRect(0,0,n.width,n.height)),e.strokeStyle="white";let i="number"==typeof t.numPoints?t.numPoints:100,a=t.maxStars||15,r=t.maxPercentage||1.12,s=t.marginX||34,l=t.marginY||20;e.fillStyle="white",e.font='12px Calibri,Candara,Segoe,"Segoe UI",Optima,Arial,sans-serif',e.textBaseline="middle",e.textAlign="right",[...Array(5)].forEach(((t,i)=>{i+=1,e.fillText(20*i+"%",s-4,(n.height-l)*(1-i/5/r),s-4)})),e.textBaseline="top",e.textAlign="left",e.fillText("star diff",0,n.height-l+4),e.textAlign="center",[...Array(a-1)].forEach(((t,i)=>{let r=i+1;e.fillText(r,s+(n.width-s)*r/a,n.height-l+4)})),e.strokeStyle="rgba(255, 255, 255, .1)",e.beginPath(),[...Array(11)].forEach(((t,i)=>{i+=1;let a=(n.height-l)*(1-i/10/r);e.moveTo(s,a),e.lineTo(n.width,a)})),e.stroke(),e.strokeStyle="white",e.beginPath(),e.moveTo(s,0),e.lineTo(s,n.height-l),e.lineTo(n.width,n.height-l),e.stroke(),e.fillStyle=t.playerSongsColor||"rgba(120, 10, 0, .9)",e.globalCompositeOperation="lighter",Object.values(W).forEach((t=>{let i=s+t.stars/a*(n.width-s),o=(n.height-l)*(1-t.score/100/r);e.fillRect(i-1,o-1,2,2)})),e.globalCompositeOperation="source-over",e.beginPath();for(let t=0;t<i;t++){let o=t/(i-1),c=ne(o*a)/100,d=s+o*(n.width-s),u=(n.height-l)*(1-c/r);e.lineTo(d,u)}e.stroke()}let se=document.getElementById("last-update");let le={avatar:document.querySelector(".player .avatar"),flag:document.querySelector(".player .flag"),name:document.querySelector(".player .name"),rank:document.querySelector(".player .rank"),pp:document.querySelector(".player .pp"),best:document.querySelector(".player .stats .best"),median:document.querySelector(".player .stats .median")};function oe(){le.avatar.style.backgroundImage="url("+Q.avatar+")",le.flag.style.backgroundImage="url("+Q.country+")",le.name.textContent=Q.name,le.name.href="https://scoresaber.com/u/"+Q.id,le.rank.textContent=Q.rank.toLocaleString(),le.pp.textContent=Q.pp.toLocaleString();let e=Object.values(W).map((e=>e.rank)).sort(((e,t)=>e-t)),t=e[~~(e.length/2)]||0,n=e[0]||0,i=e.findIndex((e=>e!==n));-1===i&&(i=e.length),le.best.textContent=n.toLocaleString(),le.best.title=i.toLocaleString()+" leaderboard"+(1===i?"":"s"),le.median.textContent=t.toLocaleString()}let ce=0;class de{constructor(e){this.list=e,this.async=!1,this.name="???",this.id="unknown"}createOptionsMarkup(){}onShow(){}onHide(){}init(){}run(e){te(e,0)}}let ue={};class pe extends de{constructor(e){super(e),this.name="Custom curve",this.id="custom-curve"}createOptionsMarkup(){let e=h("custom-curve-sort-buttons"),t=p("button","custom-curve-edit","edit curve");return t.tabIndex=-1,t.addEventListener("click",(async()=>{let e=await j(U);e&&async function(e){U=e;try{localStorage.setItem("peepee-custom-curve",JSON.stringify(e))}catch(e){}[ve,ye].forEach((e=>{e.method instanceof pe&&e.update()}))}(e)})),e.append(t),this.editButton=t,e}onShow(){this.editButton.tabIndex=0}onHide(){this.editButton.tabIndex=-1}run(e){te(e,100*x(e.stars,U))}}let he=[class extends de{constructor(e){super(e),this.name="Score est.",this.id="estimate"}run(e){te(e,ne(e.stars))}},class extends de{constructor(e){super(e),this.async=!0,this.name="Score at rank",this.id="rank"}createOptionsMarkup(){let e=p("form","rank-form");e.addEventListener("submit",(e=>e.preventDefault())),this.rankInput=p("input","rank-input"),this.rankInput.type="text",this.rankInput.placeholder=(Q.rank||1).toLocaleString()+" (desired rank)",this.rankInput.tabIndex=-1,this.rankInput.addEventListener("change",(()=>{this.list.method===this&&this.list.update()})),e.appendChild(this.rankInput);let t=p("button","rank-submit");return t.type="submit",t.tabIndex=-1,e.appendChild(t),e}onShow(){this.rankInput.tabIndex=0}onHide(){this.rankInput.tabIndex=-1}init(e){e.sort(((e,t)=>t.stars-e.stars)),e.forEach((e=>te(e,0))),this.rankInput.placeholder=(Q.rank||1).toLocaleString()+" (desired rank)",this.rank=~~+this.rankInput.value.replace(/,/g,""),(!this.rank||this.rank<=0)&&(this.rank=Q.rank||9999999),ce=0}async run(t,n){let i=this.rank,a="scoreAtRank"+i,r=!1;if(!Object.prototype.hasOwnProperty.call(t,a)){let e=0,n=t.scores;"string"==typeof n&&(n=+n.replace(/,/g,"")||1/0),i<=n+100&&i<(+t.rank||1/0)&&(e=await w(t.uid,i),ce++,r=!0),t[a]=e}if(!n()){if(te(t,t[a]||0),ce>=100)return e;r&&await v(200)}}},class extends de{constructor(e){super(e),this.name="Fixed score",this.id="raw",this.score=94.333333}createOptionsMarkup(){let e=p("form","fixed-form");e.addEventListener("submit",(e=>e.preventDefault())),this.fixedInput=p("input","fixed-input"),this.fixedInput.type="text",this.fixedInput.placeholder="94.3333%",this.fixedInput.maxLength=10,this.fixedInput.tabIndex=-1,this.fixedInput.addEventListener("change",(()=>{this.list.method===this&&this.list.update()})),e.appendChild(this.fixedInput);let t=p("button","fixed-submit");return t.type="submit",t.tabIndex=-1,e.appendChild(t),e}onShow(){this.fixedInput.tabIndex=0}onHide(){this.fixedInput.tabIndex=-1}init(){this.score=parseFloat(this.fixedInput.value.trim())||94.333333,this.score<=0&&(this.score=.01)}run(e){te(e,this.score)}},pe,class extends de{constructor(e){super(e),this.name="Compare",this.id="compare"}createOptionsMarkup(){let e=p("form","compare-form");e.addEventListener("submit",(e=>e.preventDefault())),this.compareInput=p("input","compare-input"),this.compareInput.type="text",this.compareInput.placeholder="compared profile url",this.compareInput.tabIndex=-1;let t=()=>{let t=this.compareInput.value.match(/\d{5,}/);t?(this.compareInput.value=t[0],this.list.method===this&&this.list.update()):a(e,"invalid")};this.compareInput.addEventListener("change",t),this.compareInput.addEventListener("paste",(()=>setTimeout(t,0))),this.compareInput.addEventListener("focus",(()=>this.compareInput.select())),e.appendChild(this.compareInput);let n=p("button","compare-auto","auto");n.type="button",n.tabIndex=-1,n.addEventListener("click",(async()=>{n.disabled=!0;let e=1===Q.rank?2:Math.floor(.9*Q.rank),i=await I(e);this.compareInput.value=i||"",n.disabled=!1,t()})),e.appendChild(n),this.autoButton=n;let i=p("button","compare-submit");return i.type="submit",i.tabIndex=-1,e.appendChild(i),e}onShow(){this.compareInput.tabIndex=this.autoButton.tabIndex=0}onHide(){this.compareInput.tabIndex=this.autoButton.tabIndex=-1}async init(e){e.sort(((e,t)=>t.pp-e.pp)),e.forEach((e=>te(e,0))),this.userId=this.compareInput.value,ue[this.userId]||(ue[this.userId]=_(this.userId));try{let e=await ue[this.userId];this.user=e.user,this.scores=e.scores}catch(e){this.user={},this.scores={}}}run(e){te(e,(this.scores[e.uid]||{}).score||0)}}],me=he,fe=he.concat(class extends de{constructor(e){super(e),this.name="Worst rank",this.id="worstrank"}run(e){te(e,ne(e.stars))}sort(e){return e.sort(((e,t)=>(t.rank||0)-(e.rank||0)||t.pp-e.pp))}},class extends de{constructor(e){super(e),this.name="Best rank",this.id="bestrank"}run(e){te(e,ne(e.stars))}sort(e){return e.sort(((e,t)=>(e.rank||0)-(t.rank||0)||t.pp-e.pp))}},class extends de{constructor(e){super(e),this.name="Worst score",this.id="worstscore"}run(e){te(e,ne(e.stars))}sort(e){return e.sort(((e,t)=>(e.score||0)-(t.score||0)||e.pp-t.pp))}},class extends de{constructor(e){super(e),this.name="Oldest score",this.id="oldestscore"}run(e){te(e,ne(e.stars))}sort(e){return e.sort(((e,t)=>(e.at||0)-(t.at||0)||e.pp-t.pp))}});class ge{constructor(e,t,n,i=[]){this.elem=e,this.title=t,this.selection=[],this.methods=n.map((e=>new e(this))),this.method=this.methods[0],this.elements=i,this.displayed=20,e.innerHTML="";let a=h("list-header");this.selectionTooltip=h("list-selection-tooltip");let r=h("first-line");this.mapCount=m("selection-map-count","0 maps");let s=p("button","selection-clear","clear");s.onclick=this.clearSelection.bind(this),r.append("Selection: ",this.mapCount," (",s,")"),this.selectionTooltip.appendChild(r),this.selectionTooltipPP=h("line","+0.00pp"),this.selectionTooltip.appendChild(this.selectionTooltipPP),this.selectionTooltipBplist=y("#","bplist",".bplist"),this.selectionTooltipOneClick=y("#","oneclick","OneClick");let l=h("selection-playlist",[this.selectionTooltipBplist," - ",this.selectionTooltipOneClick]);this.selectionTooltip.appendChild(l),a.appendChild(this.selectionTooltip);let o=h("list-title",t);this.titleEl=o;let c=p("button","playlist","playlist","Create a playlist");c.onclick=this.createPlaylist.bind(this),o.appendChild(c),a.appendChild(o);let d=h("method-wrapper"),u=h("method"),f=p("select");this.methods.forEach(((e,t)=>{let n=g(e.name,t);f.appendChild(n)})),f.onchange=()=>{this.changeMethod(this.methods[f.value])},u.appendChild(f);let v=p("button","unpause","","Keep going");v.addEventListener("click",(()=>{this.updating||this.update()})),u.appendChild(v),d.appendChild(u),this.methods.forEach((e=>{let t=e.createOptionsMarkup();t&&d.appendChild(t)})),a.appendChild(d),e.appendChild(a),this.content=h("list-content"),this.content.addEventListener("click",this.onContentClick.bind(this)),this.content.addEventListener("contextmenu",this.onContextMenu.bind(this)),this.content.addEventListener("scroll",this.onScroll.bind(this)),e.appendChild(this.content),this.updateSelectionTooltip(),this.update(),this.onScroll()}getPlaylistName(){let e=new Date,t=e.getFullYear()+"-"+c(e.getMonth()+1)+"-"+c(e.getDate()),n=this.title.replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();return{title:this.title+" ("+t+")",filename:n+"-"+t+".bplist"}}createPlaylist(){return K(this.elements.filter(this.filter),this.getPlaylistName())}changeMethod(e){this.method!==e&&(this.method&&(this.elem.classList.remove("method-"+this.method.id),this.method.onHide()),this.content.scrollTop=0,this.displayed=20,this.method=e,this.method&&(this.elem.classList.add("method-"+this.method.id),this.method.onShow()),this.update(),this.onScroll())}clearSelection(){this.selection=[],this.updateSelectionTooltip(),[...this.content.querySelectorAll(".element.selected")].forEach((e=>e.classList.remove("selected")))}updateSelectionTooltip(){let e=this.selection.map((e=>this.elements.find((t=>e===t.uid)))).filter((e=>e));this.selection=e.map((e=>e.uid));let t=e.length;this.mapCount.textContent=t+" map"+(1===t?"":"s");let n=ee(e.map((e=>e.uid)),e.map((e=>e.estimatePP)));this.selectionTooltipPP.textContent="+"+r(Math.max(n-G,0),2)+"pp",this.selectionTooltip.classList[t?"add":"remove"]("show");let i=this.getPlaylistName();this.selectionTooltipBplist.href=H(e,i.filename,i.title),this.selectionTooltipOneClick.href="bsplaylist://playlist/"+encodeURIComponent(this.selectionTooltipBplist.href)}getClosestElement(e){for(;e&&!e.classList.contains("element")&&this.content.contains(e);)e=e.parentElement;return e&&e.classList.contains("element")?e:null}toggleSelection(e,t){if(!e)return;let n=this.selection.includes(e);if("boolean"!=typeof t&&(t=!n),t===n)return;t?this.selection.push(e):this.selection=this.selection.filter((t=>t!==e));let i=this.content.querySelector('[data-uid="'+e+'"]');i&&i.classList[t?"add":"remove"]("selected"),this.updateSelectionTooltip()}onContentClick(e){if((e.ctrlKey||e.metaKey)&&!e.target.matches("a, button")){let t=this.getClosestElement(e.target),n=t&&+t.getAttribute("data-uid");this.toggleSelection(n)}}onContextMenu(e){if(e.ctrlKey||e.metaKey||e.target.matches("a, button")||!window.ContextMenu)return;let t=this.getClosestElement(e.target),n=t&&+t.getAttribute("data-uid");if(!n)return;e.preventDefault(),e.stopPropagation();let i=this.selection.includes(n);window.ContextMenu.show([{text:(i?"Deselect":"Select")+" map",shortcut:"Ctrl+Click",action:()=>this.toggleSelection(n)},{text:"Screw this (hide map)",action:()=>async function(e){let t=D.hiddenMaps||[];t.push(e),F(Object.assign(D,{hiddenMaps:t}))}(n)},{separator:!0},{text:"Show help",action:Ae}],{x:e.clientX,y:e.clientY})}onScroll(){this.content.scrollTop+this.content.clientHeight>this.content.scrollHeight-50&&this.displayMore()}displayMore(){this.displayed>=this.elements.length||(this.displayed+=20,this.refresh())}createMarkup(e){let t=h("element");t.setAttribute("data-uid",e.uid);let n=h("left"),a=h("pic");a.style.backgroundImage="url(https://scoresaber.com/imports/images/songs/"+e.id+".png)",n.appendChild(a);let s=h("name-group"),l=h("name-and-artist");l.title=e.name+" - "+e.artist,l.appendChild(m("name",(e.name||"")+" ")),l.appendChild(m("sep")),l.appendChild(m("artist",e.artist)),s.appendChild(l),s.appendChild(h("mapper",e.mapper));let o=e.diff||"Easy",c=i[o]||{},f=h("difficulty-and-score");if(f.appendChild(m("difficulty "+(c.className||o.toLowerCase()),(c.display||o)+" ")),e.score||0===e.score){let t=m("score-and-rank");if(t.appendChild(m("score",[r(e.score,2),m("percent-sign","% ")])),e.at){let n=new Date(e.at);t.appendChild(m("at",u(n)+" ",d(n)))}t.appendChild(m("sep")),t.appendChild(m("rank",e.rank.toLocaleString())),f.appendChild(t)}s.appendChild(f),n.appendChild(s),t.appendChild(n);let g=h("middle");g.appendChild(h("pot-title","Potential")),e._potScore=h("pot-score"),g.appendChild(e._potScore);let v=h("pot-pp");e._potPP=m("raw"),v.appendChild(e._potPP),e._potInc=m("increase",null,"Total (weighted) pp change"),v.appendChild(e._potInc),g.appendChild(v),t.appendChild(g);let b=h("right"),C=h("important");C.appendChild(h("star-difficulty",e.stars,"Star difficulty")),void 0!==e.upvotes&&C.appendChild(h("upvotes",e.upvotes,"Upvotes")),void 0!==e.downvotes&&C.appendChild(h("downvotes",e.downvotes,"Downvotes")),b.appendChild(C);let A=h("secondary");e.duration&&A.appendChild(h("duration",function(e){let t=e.durationSeconds||60*e.duration/e.bpm;return Math.floor(t/60)+":"+("0"+Math.round(t%60)).slice(-2)}(e),"Duration")),A.appendChild(h("bpm",r(e.bpm,2),"BPM")),b.appendChild(A);let k=h("links");if(e.beatSaverKey){let t=p("button","bsr",null,"Copy !bsr request");t.addEventListener("click",(()=>function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}("!bsr "+e.beatSaverKey))),k.appendChild(t)}e.download&&k.appendChild(y(e.download,"download",null,"Download map","_blank")),e.beatSaverKey&&(k.appendChild(y("beatsaver://"+e.beatSaverKey,"oneclick",null,"OneClick™ install")),k.appendChild(y("https://beatsaver.com/beatmap/"+e.beatSaverKey,"beatsaver",null,"Open on BeatSaver","_blank"))),k.appendChild(y("https://scoresaber.com/leaderboard/"+e.uid,"leaderboards",null,"ScoreSaber leaderboard","_blank")),b.appendChild(k),t.appendChild(b),e.markup=t}async update(){let t=this.elements,n=t.length;this.titleEl.title=n+" leaderboard"+(1===n?"":"s");let i=this.method,a=Date.now();this.elem.classList.remove("paused"),this.updating&&this.elem.classList.remove("loading"),this.updating=a,this.elem.classList.add("loading"),await i.init(t),this.refresh();let r=()=>this.updating!==a,s=Date.now(),l=!1;for(let n=0;n<t.length;n++){let a=await i.run(t[n],r);if(i.async){if(r())return;let e=Date.now();e-s>1e3?(s=e,this.refresh(),l=!1):l=!0}if(a===e){this.elem.classList.add("paused");break}}this.elem.classList.remove("loading"),i.async&&!l||this.refresh(),this.updating=!1}defaultSort(e){return e.sort(((e,t)=>(t.estimateFull||0)-(e.estimateFull||0)||t.pp-e.pp))}filter(e){return(!D.hiddenMaps||!D.hiddenMaps.includes(e.uid))&&(!(e.estimateScore<D.scoreFrom||e.estimateScore>D.scoreTo)&&!(e.stars<D.starsFrom||e.stars>D.starsTo))}refresh(){for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);let e=this.method.sort||this.defaultSort;this.elements=e(this.elements),this.elements.filter(this.filter).slice(0,this.displayed).forEach((e=>{e.markup||this.createMarkup(e),void 0===e.estimateScore&&te(e,0),e._potScore.textContent=r(e.estimateScore,2),e._potPP.textContent=r(e.estimatePP,2),e._potInc.textContent=r(Math.max(e.estimateFull-G,0),2),this.content.appendChild(e.markup)}))}}let ye=new ge(document.querySelector(".list.unplayed"),"Not played",me),ve=new ge(document.querySelector(".list.played"),"To improve",fe);async function be(e){if(e&&e.preventDefault&&e.preventDefault(),E.classList.contains("loading"))return;let t=L.value.match(/\d{5,}/);if(!t)return void a(E,"invalid");let n=t[0];P.textContent="Getting user infos...",E.classList.add("loading"),L.disabled=!0,V=Date.now();try{let e,t=await z;J=t.list.reduce(((e,t)=>(e[t.uid]=t,e)),{});let i={useCache:location.search.includes("debug"),onProgress:e=>P.textContent="Getting scores page "+e+"...",onUserInfo:e=>N(e)};if(e=await _(n,i),!e)return void a(E,"invalid");W=e.scores,G=ee(0,0),oe(),$(t,W),window.playerSongs=W,document.body.classList.add("step-results","user-"+n)}catch(e){console.error(e),a(E,"invalid")}L.disabled=!1,E.classList.remove("loading")}E.addEventListener("submit",be),L.addEventListener("paste",(()=>setTimeout(be,0))),L.addEventListener("focus",(()=>L.select()));let Ce=document.getElementById("show-help");function Ae(){Ce.checked=!Ce.checked}document.getElementById("back").addEventListener("click",(()=>{L.value="",document.body.classList.remove("step-results")})),document.getElementById("refresh").addEventListener("click",(async function(){if(!Q||!Q.id)return;document.body.classList.add("refreshing");try{let e=V;V=Date.now();let t=await async function(e,t,n){n=n||{};let i,a=1,r=[],s={};for(let l=!0;l;a++){"function"==typeof n.onProgress&&n.onProgress(a);let o=await C(e,a,2);1===a&&(i=Y(e,o),"function"==typeof n.onUserInfo&&n.onUserInfo(i));let c=Z(o);if(!c)break;let d=Math.min(...c.map((e=>e.at)));c=c.filter((e=>e.userPP&&e.at>t)),r.push(...c),c=c.map(X).filter((e=>e)),c.forEach((e=>s[e.uid]=e)),d>=t?await v(200):l=!1}return{user:i,scores:s,rawScores:r}}(Q.id,e);Q=t.user,Object.assign(W,t.scores),N(Q),G=ee(0,0),oe()}catch(e){}let e=A(new Date(R));try{await e,z=e}catch(e){}$(await z,W),document.body.classList.remove("refreshing")})),document.getElementById("show-filters").addEventListener("click",(async()=>{let e=await q(D);e&&F(e)})),document.getElementById("export-curve").addEventListener("click",(()=>{let e=document.createElement("canvas");e.width=800,e.height=400,re(e.getContext("2d"),{background:!0,numPoints:500});let t=(Q.name||"").replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();!function(e,t){let n=y(e);n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.toDataURL(),t+"-score-curve.png")}))}();
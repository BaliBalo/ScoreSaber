!async function(){const e={GN:.04,DA:.02,FS:.08,NF:-.5,NO:-.05,NB:-.1,SS:-.3,NA:-.3},t=[{at:0,value:0},{at:45,value:.015},{at:50,value:.03},{at:55,value:.06},{at:60,value:.105},{at:65,value:.16},{at:68,value:.24},{at:70,value:.285},{at:80,value:.563},{at:84,value:.695},{at:88,value:.826},{at:94.5,value:1.015},{at:95,value:1.046},{at:100,value:1.12},{at:110,value:1.18},{at:114,value:1.25}],a={ExpertPlus:{className:"expert-plus",display:"Expert+"}};function n(e,t){e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}function r(e,t=0){return e.toFixed(t).replace(/\.?0*$/,"")}function i(e){return("0"+e).slice(-2)}const s=function(){const e=864e5;let t=(e,t)=>~~(e/t),a=(e,t)=>e+" "+t+(1!==e&&-1!==e?"s":"");return n=>function(n,r){let i=r-n,s=Math.abs(i);if(s<6e4)return a(t(i,1e3),"second");if(s<36e5)return a(t(i,6e4),"minute");if(s<e)return a(t(i,36e5),"hour");if(s<2592e6)return a(t(i,e),"day");let l=function(e,t){let a=t.getFullYear()-e.getFullYear();return t.getMonth()-e.getMonth()+12*a}(n,r);return Math.abs(l)<12?a(l,"month"):a(~~(l/12),"year")}(n,new Date)+" ago"}();function l(e,t,a,n){let r=document.createElement(e);return null!=t&&(r.className=t),null!=a&&(r.textContent=a),null!=n&&(r.title=n),r}let o=l.bind(null,"div"),d=(e,t,a,n,r)=>{let i=l("a",t,a,n);return i.href=e,r&&(i.target=r),i};function c(e,t){let a=document.createElement("a");a.download=t,a.href=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}async function p(e){await new Promise(t=>setTimeout(t,e))}function u(...e){return fetch(...e).then(e=>e.json())}async function h(...e){return fetch(...e).then(e=>e.ok?e.text():Promise.reject()).then(e=>{if(-1===e.indexOf("<html"))throw new Error("not an HTML page: "+e);return(new DOMParser).parseFromString(e,"text/html")})}async function m(e,t,a=1,n=2){return h("/proxy/u/"+e+"?sort="+a+"&page="+(t||1)).catch(async r=>{if(n-- >0)return await p(1e3),m(e,t,a,n);throw r})}function g(t){return t?t.split(",").reduce((t,a)=>t+(e[a.trim()]||0),1):1}function f(e){if(!e)return null;let t=e.getAttribute("src");return t.match(/^https?:\/\//)||(t="https://scoresaber.com"+("/"===t[0]?"":"/")+t),t}WebFont.load({custom:{families:["NeonTubes"]}});let A=document.getElementById("user"),y=document.getElementById("profile"),C=document.getElementById("user-fetch-info"),v=[];try{let e=JSON.parse(localStorage.getItem("history"));Array.isArray(e)&&(v=e)}catch(e){}let b=document.querySelector(".history");function k(){b.innerHTML="",v.slice(0,5).forEach(e=>{if(!e||!e.avatar||null==e.rank||!e.name)return;let t=o("line");t.onclick=()=>{y.disabled||(y.value=e.id,z())};let a=o("avatar");a.style.backgroundImage="url("+e.avatar+")",t.appendChild(a),t.appendChild(o("rank",e.rank.toLocaleString())),t.appendChild(o("name",e.name)),b.appendChild(t)})}k();let w={},S={},x={},I=Date.now(),E=0,L=u("/ranked"),P=0;function O(e,t){let a=t.querySelector("h5.title"),n=a&&a.textContent.trim();if(!n)throw new Error("Invalid Profile");let r=t.querySelector(".avatar img"),i=a.querySelector("img"),s=t.querySelector("h5.title ~ ul"),l=s&&s.textContent||"",o=l.match(/#([\d,]+) /),d=l.match(/([\d,.]+)pp/),c={id:e,name:n,avatar:f(r),country:f(i),rank:o?+o[1].replace(/\D/g,""):0,pp:d?+d[1].replace(/[^\d.]/g,""):0};v=v.filter(e=>e&&e.id!==c.id),v.unshift(c),v=v.slice(0,5);try{localStorage.setItem("history",JSON.stringify(v))}catch(e){}return k(),c}function D(e){if(!e)return;let t=e.querySelector("table.ranking.songs tbody");if(!t)throw new Error("Error while parsing results page - maybe scoresaber is having issues?");return[...t.querySelectorAll("tr")].map(e=>{let t=e.querySelector('a[href*="/leaderboard/"]'),a=t&&t.href.match(/\/leaderboard\/(\d+)/);if(!a)return;let n=+a[1],r=e.querySelector(".ppValue"),i=r&&+r.textContent,s=e.querySelector(".rank"),l=s&&s.textContent.match(/#?([\d,]+)/),o=e.querySelector(".time"),d=Date.now();if(o){let e=(o.title||"").replace(/^.*(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2}).*$/,"$1T$2Z");d=+new Date(e)||d}let c=e.querySelector(".ppWeightedValue"),p=c&&c.textContent.match(/([\d.]+)/),u=e.querySelector(".scoreBottom"),h=u&&u.textContent.match(/([\d.]+)%/),m=h&&+h[1]||0,f=u&&u.textContent.match(/\(([^)]+)\)/),A=g(f&&f[1]);return{uid:n,rank:l&&+l[1].replace(/\D/g,"")||1/0,at:d,userPP:i,weighted:p&&+p[1]||0,score:m*A,modScore:m}}).filter(e=>e)}function M(e,t){G.elements=Object.values(t),J.elements=e.list.filter(e=>!Object.prototype.hasOwnProperty.call(t,e.uid)).map(e=>Object.assign({},e)),G.update(),J.update(),Q()}function T(e,t){let a=Object.values(S).filter(t=>t.uid!==e).map(e=>e.userPP);t&&a.push(t),a.sort((e,t)=>t-e);let n=1;return a.reduce((e,t,a)=>e+t*(n*=a?.965:1),0)}function q(e,a){if(e.score&&e.score>=a)return e.estimateScore=e.score,e.estimatePP=e.userPP,void(e.estimateFull=P);e.estimateScore=a,e.estimatePP=e.pp*function(e){if(!e||e<=0)return 0;let a=t.findIndex(t=>t.at>=e);if(-1===a)return t[t.length-1].value;if(!a)return t[0].value;let n=t[a-1],r=t[a],i=(e-n.at)/(r.at-n.at);return n.value+(r.value-n.value)*i}(a),e.estimateFull=T(e.uid,e.estimatePP)}function B(e){let t=Date.now(),a=Object.values(S),n=Math.max(...a.map(e=>e.stars)),r=a.reduce((a,n)=>{let r=2*Math.abs(e-n.stars),i=e>n.stars?r*r*r:1,s=n.at||t,l=1/(1+r*(1+Math.max(t-s,0)/1296e6)*i);return a.weight+=l,a.sum+=n.score*l,a},{weight:0,sum:0}),i=r.weight?r.sum/r.weight:0;if(e>n){let t=2*Math.abs(e-n);i/=1+t*t}return i}let F=document.getElementById("score-est-curve").getContext("2d");function Q(e,t){t=t||{};let a=(e=e||F).canvas;e.clearRect(0,0,a.width,a.height),t.background&&(e.fillStyle=!0===t.background?"#1e1f26":t.background,e.fillRect(0,0,a.width,a.height)),e.strokeStyle="white";let n=t.numPoints||100,r=t.maxStars||12,i=t.maxPercentage||1.12,s=t.marginX||34,l=t.marginY||20;e.fillStyle="white",e.font='12px Calibri,Candara,Segoe,"Segoe UI",Optima,Arial,sans-serif',e.textBaseline="middle",e.textAlign="right",[...Array(5)].forEach((t,n)=>{n+=1,e.fillText(20*n+"%",s-4,(a.height-l)*(1-n/5/i),s-4)}),e.textBaseline="top",e.textAlign="left",e.fillText("star diff",0,a.height-l+4),e.textAlign="center",[...Array(r-1)].forEach((t,n)=>{let i=n+1;e.fillText(i,s+(a.width-s)*i/r,a.height-l+4)}),e.strokeStyle="rgba(255, 255, 255, .1)",e.beginPath(),[...Array(11)].forEach((t,n)=>{n+=1;let r=(a.height-l)*(1-n/10/i);e.moveTo(s,r),e.lineTo(a.width,r)}),e.stroke(),e.strokeStyle="white",e.beginPath(),e.moveTo(s,0),e.lineTo(s,a.height-l),e.lineTo(a.width,a.height-l),e.stroke(),e.fillStyle="rgba(120, 10, 0, .9)",e.globalCompositeOperation="lighter",Object.values(S).forEach(t=>{let n=s+t.stars/r*(a.width-s),o=(a.height-l)*(1-t.score/100/i);e.fillRect(n-1,o-1,2,2)}),e.globalCompositeOperation="source-over",e.beginPath();for(let t=0;t<n;t++){let o=t/(n-1),d=B(o*r)/100,c=s+o*(a.width-s),p=(a.height-l)*(1-d/i);e.lineTo(c,p)}e.stroke()}let U={avatar:document.querySelector(".player .avatar"),flag:document.querySelector(".player .flag"),name:document.querySelector(".player .name"),rank:document.querySelector(".player .rank"),pp:document.querySelector(".player .pp"),best:document.querySelector(".player .stats .best"),median:document.querySelector(".player .stats .median")};function N(){U.avatar.style.backgroundImage="url("+w.avatar+")",U.flag.style.backgroundImage="url("+w.country+")",U.name.textContent=w.name,U.name.href="https://scoresaber.com/u/"+w.id,U.rank.textContent=w.rank.toLocaleString(),U.pp.textContent=w.pp.toLocaleString();let e=Object.values(S).map(e=>e.rank).sort((e,t)=>e-t),t=e[~~(e.length/2)]||0,a=e[0]||0,n=e.findIndex(e=>e!==a);-1===n&&(n=e.length),U.best.textContent=a.toLocaleString(),U.best.title=n.toLocaleString()+" leaderboard"+(1===n?"":"s"),U.median.textContent=t.toLocaleString()}let V=0;class j{constructor(e){this.list=e,this.async=!1,this.name="???",this.id="unknown"}createOptionsMarkup(){}init(){}run(e){q(e,0)}}let W=[class extends j{constructor(e){super(e),this.name="Score est.",this.id="estimate"}run(e){q(e,B(e.stars))}},class extends j{constructor(e){super(e),this.async=!0,this.name="Score at rank",this.id="rank"}createOptionsMarkup(){let e=l("form","rank-form");e.addEventListener("submit",e=>e.preventDefault()),this.rankInput=l("input","rank-input"),this.rankInput.type="text",this.rankInput.placeholder=(w.rank||1).toLocaleString()+" (desired rank)",this.rankInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.rankInput);let t=l("button","rank-submit");return t.type="submit",e.appendChild(t),e}init(e){e.sort((e,t)=>t.stars-e.stars),this.rankInput.placeholder=(w.rank||1).toLocaleString()+" (desired rank)",this.rank=~~+this.rankInput.value.replace(/,/g,""),(!this.rank||this.rank<=0)&&(this.rank=w.rank||9999999),V=0}async run(e,t){let a=this.rank,n="scoreAtRank"+a,r=!1;if(!Object.prototype.hasOwnProperty.call(e,n)){let t=0,i=e.scores;"string"==typeof i&&(i=+i.replace(/,/g,"")||1/0),a<=i+100&&a<(+e.rank||1/0)&&(t=await async function e(t,a,n=2){if(!t||!a)return console.log("Invalid score at rank request",t,a),0;let r=Math.ceil(a/12),i=a-12*(r-1);try{let e=await h("/proxy/leaderboard/"+t+"?page="+(r||1));if(!e)return 0;let a=e.querySelector(".ranking tbody tr:nth-child("+i+")");if(!a)return 0;let n=a.querySelector(".percentage"),s=(n&&n.textContent||"").match(/[\d.]+/);if(!s)return 0;let l=a.querySelector(".mods"),o=g(l&&l.textContent),d=n&&n.querySelector("span[style*=tomato]");return s[0]*o*(d?110/115:1)}catch(r){return n-- >0?(await p(1e3),e(t,a,n)):(console.log("Error getting score at rank",r),0)}}(e.uid,a),V++,r=!0),e[n]=t}if(!t()){if(q(e,e[n]||0),V>=100)return"PAUSE_UPDATE";r&&await p(200)}}},class extends j{constructor(e){super(e),this.name="Fixed score",this.id="raw",this.score=94.333333}createOptionsMarkup(){let e=l("form","fixed-form");e.addEventListener("submit",e=>e.preventDefault()),this.fixedInput=l("input","fixed-input"),this.fixedInput.type="text",this.fixedInput.placeholder="94.3333%",this.fixedInput.maxLength=10,this.fixedInput.addEventListener("change",()=>{this.list.method===this&&this.list.update()}),e.appendChild(this.fixedInput);let t=l("button","fixed-submit");return t.type="submit",e.appendChild(t),e}init(){this.score=parseFloat(this.fixedInput.value.trim())||94.333333,this.score<=0&&(this.score=.01)}run(e){q(e,this.score)}}],K=W.concat(class extends j{constructor(e){super(e),this.name="Worst rank",this.id="worstrank"}run(e){q(e,B(e.stars))}sort(e){return e.sort((e,t)=>(t.rank||0)-(e.rank||0)||t.pp-e.pp)}},class extends j{constructor(e){super(e),this.name="Best rank",this.id="bestrank"}run(e){q(e,B(e.stars))}sort(e){return e.sort((e,t)=>(e.rank||0)-(t.rank||0)||t.pp-e.pp)}},class extends j{constructor(e){super(e),this.name="Worst score",this.id="worstscore"}run(e){q(e,B(e.stars))}sort(e){return e.sort((e,t)=>(e.score||0)-(t.score||0)||e.pp-t.pp)}},class extends j{constructor(e){super(e),this.name="Oldest score",this.id="oldestscore"}run(e){q(e,B(e.stars))}sort(e){return e.sort((e,t)=>(e.at||0)-(t.at||0)||e.pp-t.pp)}});class H{constructor(e,t,a,n=[]){this.elem=e,this.title=t,this.methods=a.map(e=>new e(this)),this.method=this.methods[0],this.elements=n,this.displayed=20,this.onScroll=this.onScroll.bind(this),e.innerHTML="";let r=o("list-header"),i=o("list-title",t);this.titleEl=i;let s=l("button","playlist","","Create a playlist");s.onclick=this.createPlaylist.bind(this),i.appendChild(s),r.appendChild(i);let d=o("method-wrapper"),c=o("method"),p=l("select");this.methods.forEach((e,t)=>{let a=((e,t)=>{let a=l("option");return a.textContent=e,a.value=t,a})(e.name,t);p.appendChild(a)}),p.onchange=()=>{this.changeMethod(this.methods[p.value])},c.appendChild(p);let u=l("button","unpause","","Keep going");u.addEventListener("click",()=>{this.updating||this.update()}),c.appendChild(u),d.appendChild(c),this.methods.forEach(e=>{let t=e.createOptionsMarkup();t&&d.appendChild(t)}),r.appendChild(d),e.appendChild(r),this.content=o("list-content"),this.content.addEventListener("scroll",this.onScroll),e.appendChild(this.content),this.update(),this.onScroll()}createPlaylist(){let e=+prompt("Number of items to include in the playlist",50);if(!e)return;let t=(new Date).toISOString().slice(0,10),a=this.elements.filter(e=>e.id).slice(0,e).map(e=>({hash:e.id,songName:e.name})),n={playlistTitle:this.title+" ("+t+")",playlistAuthor:"Peepee",image:"data:image/png;base64,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",songs:a},r=this.title.replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();c("data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),r+"-"+t+".bplist")}changeMethod(e){this.method!==e&&(this.method&&this.elem.classList.remove("method-"+this.method.id),this.content.scrollTop=0,this.displayed=20,this.method=e,this.method&&this.elem.classList.add("method-"+this.method.id),this.update(),this.onScroll())}onScroll(){this.content.scrollTop+this.content.clientHeight>this.content.scrollHeight-50&&this.displayMore()}displayMore(){this.displayed>=this.elements.length||(this.displayed+=20,this.refresh())}createMarkup(e){let t=o("element"),n=o("left"),c=o("pic");c.style.backgroundImage="url(https://scoresaber.com/imports/images/songs/"+e.id+".png)",n.appendChild(c);let p=o("name-group"),u=o("name-and-artist");u.title=e.name+" - "+e.artist,u.appendChild(l("span","name",e.name)),u.appendChild(l("span","sep")),u.appendChild(l("span","artist",e.artist)),p.appendChild(u),p.appendChild(o("mapper",e.mapper));let h=e.diff||"Easy",m=a[h]||{},g=o("difficulty-and-score");if(g.appendChild(l("span","difficulty "+(m.className||h.toLowerCase()),m.display||h)),e.score||0===e.score){let t=l("span","score-and-rank");if(t.appendChild(l("span","score",r(e.score,2))),e.at){let a=new Date(e.at);t.appendChild(l("span","at",s(a),(f=a).getFullYear()+"-"+i(f.getMonth()+1)+"-"+i(f.getDate())+" "+i(f.getHours())+":"+i(f.getMinutes())))}t.appendChild(l("span","sep")),t.appendChild(l("span","rank",e.rank.toLocaleString())),g.appendChild(t)}var f;p.appendChild(g),n.appendChild(p),t.appendChild(n);let A=o("middle");A.appendChild(o("pot-title","Potential")),e._potScore=o("pot-score"),A.appendChild(e._potScore);let y=o("pot-pp");e._potPP=l("span"),y.appendChild(e._potPP),e._potInc=l("span","increase",null,"Total (weighted) pp change"),y.appendChild(e._potInc),A.appendChild(y),t.appendChild(A);let C=o("right"),v=o("important");v.appendChild(o("star-difficulty",e.stars,"Star difficulty")),void 0!==e.upvotes&&v.appendChild(o("upvotes",e.upvotes,"Upvotes")),void 0!==e.downvotes&&v.appendChild(o("downvotes",e.downvotes,"Downvotes")),C.appendChild(v);let b=o("secondary");e.duration&&b.appendChild(o("duration",function(e){let t=e.duration/e.bpm,a=Math.floor(t);return a+":"+("0"+Math.round(60*(t-a))).slice(-2)}(e),"Duration")),b.appendChild(o("bpm",r(e.bpm,2),"BPM")),C.appendChild(b);let k=o("links");if(e.beatSaverKey){let t=l("button","bsr",null,"Copy !bsr request");t.addEventListener("click",()=>function(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}("!bsr "+e.beatSaverKey)),k.appendChild(t)}e.download&&k.appendChild(d(e.download,"download",null,"Download map","_blank")),e.beatSaverKey&&(k.appendChild(d("beatsaver://"+e.beatSaverKey,"oneclick",null,"OneClick install")),k.appendChild(d("https://beatsaver.com/beatmap/"+e.beatSaverKey,"beatsaver",null,"Open on BeatSaver","_blank"))),k.appendChild(d("https://scoresaber.com/leaderboard/"+e.uid,"leaderboards",null,"ScoreSaber leaderboard","_blank")),C.appendChild(k),t.appendChild(C),e.markup=t}async update(){let e=this.elements,t=e.length;this.titleEl.title=t+" leaderboard"+(1===t?"":"s");let a=this.method,n=Date.now();this.elem.classList.remove("paused"),this.updating&&this.elem.classList.remove("loading"),this.updating=n,a.async&&this.elem.classList.add("loading"),await a.init(e),this.refresh();let r=()=>this.updating!==n;for(let t=0;t<e.length;t++){let n=await a.run(e[t],r);if(a.async){if(r())return;this.refresh()}if("PAUSE_UPDATE"===n){this.elem.classList.add("paused");break}}a.async?this.elem.classList.remove("loading"):this.refresh(),this.updating=!1}defaultSort(e){return e.sort((e,t)=>(t.estimateFull||0)-(e.estimateFull||0)||t.pp-e.pp)}refresh(){for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);let e=this.method.sort||this.defaultSort;this.elements=e(this.elements),this.elements.slice(0,this.displayed).forEach(e=>{e.markup||this.createMarkup(e),void 0===e.estimateScore&&q(e,0),e._potScore.textContent=r(e.estimateScore,2)+"%",e._potPP.textContent=r(e.estimatePP,2)+"pp",e._potInc.textContent=r(Math.max(e.estimateFull-P,0),2),this.content.appendChild(e.markup)})}}let J=new H(document.querySelector(".list.unplayed"),"Not played",W),G=new H(document.querySelector(".list.played"),"To improve",K),R=document.getElementById("last-update");async function z(e){if(e&&e.preventDefault&&e.preventDefault(),A.classList.contains("loading"))return;let t=y.value.match(/\d{5,}/);if(!t)return void n(A,"invalid");let a=t[0];C.textContent="Getting user infos...",A.classList.add("loading"),y.disabled=!0,I=Date.now();try{let e=await L;x=e.list.reduce((e,t)=>(e[t.uid]=t,e),{}),E=e.timestamp,R.textContent=new Date(E).toString(),S={},await async function e(t,a=1){C.textContent="Getting scores page "+a+"...";let n=await m(t,a);1===a&&(w=O(t,n));let r=D(n);if(r){r=r.filter(e=>e.userPP);let n=r.length;if(r=r.map(e=>{let t=x[e.uid];if(t)return Object.assign({},t,e)}).filter(e=>e),r.forEach(e=>S[e.uid]=e),8===n)return await p(200),e(t,a+1)}}(a),P=T(0,0),N(),M(e,S),window.playerSongs=S,document.body.classList.add("step-results","user-"+a)}catch(e){console.log(e),n(A,"invalid")}y.disabled=!1,A.classList.remove("loading")}A.addEventListener("submit",z),y.addEventListener("paste",()=>setTimeout(z,0)),y.addEventListener("focus",()=>y.select()),document.getElementById("back").addEventListener("click",()=>{y.value="",document.body.classList.remove("step-results")}),document.getElementById("refresh").addEventListener("click",(async function(){if(!w||!w.id)return;document.body.classList.add("refreshing");try{let e=I;I=Date.now(),await async function e(t,a,n=1){let r=await m(t,n,2);1===n&&(w=O(t,r));let i=D(r);if(i){let r=Math.min(...i.map(e=>e.at));if(i=i.map(e=>{let t=x[e.uid];if(t)return Object.assign({},t,e)}).filter(e=>e),i.forEach(e=>S[e.uid]=e),r>=a)return e(t,a,n+1)}}(w.id,e)}catch(e){}P=T(0,0),N();let e=u("/ranked",{headers:{"If-Modified-Since":new Date(E).toUTCString()}});try{await e,L=e}catch(e){}M(await L,S),document.body.classList.remove("refreshing")})),document.getElementById("export-curve").addEventListener("click",()=>{let e=document.createElement("canvas");e.width=800,e.height=400,Q(e.getContext("2d"),{background:!0,numPoints:500});let t=(w.name||"").replace(/[\W-]+/g,"-").replace(/^-|-$/g,"").toLowerCase();c(e.toDataURL(),t+"-score-curve.png")})}();
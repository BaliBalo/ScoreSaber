(async()=>{document.body.addEventListener("mousedown",(()=>{document.body.classList.add("mouse")})),document.body.addEventListener("keydown",(()=>{document.body.classList.remove("mouse")}));const e={transparent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",scoresaber:"/client/scoresaber.png",peepoUK:"/client/icon.png"};let t=(await fetch("/ranked").then((e=>e.json()))).list,n=document.querySelector.bind(document),a={difficulty:{},stars:{from:n(".stars .from input"),to:n(".stars .to input")},rating:{from:n(".rating .from input"),to:n(".rating .to input")},duration:{from:n(".duration .from input"),to:n(".duration .to input")},name:n(".name"),author:n(".author"),count:n(".count"),sort:n(".sort")},o={count:n(".result-count"),list:n(".preview .list")},r=n(".difficulties");[{name:"Easy"},{name:"Normal"},{name:"Hard"},{name:"Expert"},{name:"ExpertPlus",label:"Expert+"}].forEach((e=>{let t=document.createElement("label"),n=document.createElement("input"),o=document.createElement("span");n.type="checkbox",n.checked="true",n.addEventListener("change",u),t.appendChild(n),o.appendChild(document.createTextNode(e.label||e.name)),t.appendChild(o),a.difficulty[e.name]=n,r.appendChild(t)}));let i=n(".image-options");Object.keys(e).forEach((async(t,n)=>{let a=e[t],o=document.createElement("label"),r=document.createElement("input"),d=document.createElement("img");o.className=t,r.type="radio",r.name="image",r.checked=!n,d.crossOrigin="anonymous",await new Promise(((e,t)=>{d.onload=e,d.onerror=t,d.src=a}));let s=document.createElement("canvas"),l=s.getContext("2d");s.height=d.naturalHeight,s.width=d.naturalWidth,l.drawImage(d,0,0),r.value=s.toDataURL("image/png"),r.addEventListener("change",c),o.appendChild(r),o.appendChild(d),i.appendChild(o)}));let d=[];function s(e,t,n){return!(e<t||e>n)}function l(e,t){if(!e)return t;if(+e)return+e;let n=e.match(/^\s*(\d+)\s*:\s*(\d+)\s*$/);return n?+n[2]+60*n[1]:t}function u(){let e=[+a.stars.from.value||0,+a.stars.to.value||1/0].sort(((e,t)=>e-t)),n=[+a.rating.from.value||0,+a.rating.to.value||100].sort(((e,t)=>e-t)),r=[l(a.duration.from.value,0),l(a.duration.to.value,1/0)].sort(((e,t)=>e-t)),i=t.filter((t=>{if(!a.difficulty[t.diff].checked)return!1;let o=60*t.duration/t.bpm;return s(t.stars,e[0],e[1])&&s(t.rating,n[0],n[1])&&s(o,r[0],r[1])})),[u,m]=a.sort.value.split("-");for(m="desc"===m?-1:1,i.sort(((e,t)=>e[u]<t[u]?-m:e[u]>t[u]?m:0));o.list.firstChild;)o.list.removeChild(o.list.firstChild);d=i.map(((e,t)=>{let n=document.createElement("div");n.className="item",n.title=["downloads: "+e.downloads,"upvotes: "+e.upvotes,"downvotes: "+e.downvotes].join("\n");let a=t+1+". "+e.artist+" - "+e.name+" | "+e.mapper,r=[e.rating&&"👍 "+e.rating.toFixed(2)+"%",e.diff].filter((e=>e)).join(" - ");return r&&(a+=" ("+r+")"),n.appendChild(document.createTextNode(a)),o.list.appendChild(n),{hash:e.id,songName:e.name,difficulties:[{characteristic:"Standard",name:e.diff}]}}));let p=i.length,f=d.length;o.count.textContent=p+" leaderboard"+(1===p?"":"s")+" from "+f+" map"+(1===f?"":"s"),c()}function c(){let t=e.transparent,o=n(".image-options input:checked");o&&(t=o.value);let r={playlistTitle:a.name.value||a.name.placeholder,playlistAuthor:a.author.value||a.author.placeholder,image:t,songs:d.slice(0,+a.count.value||1/0)};n(".download").href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r))}[a.stars.from,a.stars.to,a.rating.from,a.rating.to,a.duration.from,a.duration.to,a.sort].forEach((e=>e.addEventListener("input",u))),[a.name,a.author,a.count].forEach((e=>e.addEventListener("input",c))),u(),document.body.classList.add("loaded")})();
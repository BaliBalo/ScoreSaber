(async()=>{document.body.addEventListener("mousedown",()=>{document.body.classList.add("mouse")}),document.body.addEventListener("keydown",()=>{document.body.classList.remove("mouse")});const e={transparent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",scoresaber:"/client/scoresaber.png",peepoUK:"/client/icon.png"};let t=(await fetch("/ranked").then(e=>e.json())).list,a=document.querySelector.bind(document),n={difficulty:{},stars:{from:a(".stars .from input"),to:a(".stars .to input")},rating:{from:a(".rating .from input"),to:a(".rating .to input")},duration:{from:a(".duration .from input"),to:a(".duration .to input")},name:a(".name"),author:a(".author"),count:a(".count"),sort:a(".sort")},o={count:a(".result-count"),list:a(".preview .list")},r=a(".difficulties");[{name:"Easy"},{name:"Normal"},{name:"Hard"},{name:"Expert"},{name:"ExpertPlus",label:"Expert+"}].forEach(e=>{let t=document.createElement("label"),a=document.createElement("input"),o=document.createElement("span");a.type="checkbox",a.checked="true",a.addEventListener("change",u),t.appendChild(a),o.appendChild(document.createTextNode(e.label||e.name)),t.appendChild(o),n.difficulty[e.name]=a,r.appendChild(t)});let i=a(".image-options");Object.keys(e).forEach(async(t,a)=>{let n=e[t],o=document.createElement("label"),r=document.createElement("input"),d=document.createElement("img");o.className=t,r.type="radio",r.name="image",r.checked=!a,d.crossOrigin="anonymous",await new Promise((e,t)=>{d.onload=e,d.onerror=t,d.src=n});let l=document.createElement("canvas"),s=l.getContext("2d");l.height=d.naturalHeight,l.width=d.naturalWidth,s.drawImage(d,0,0),r.value=l.toDataURL("image/png"),r.addEventListener("change",c),o.appendChild(r),o.appendChild(d),i.appendChild(o)});let d=[];function l(e,t,a){return!(e<t||e>a)}function s(e,t){if(!e)return t;if(+e)return+e;let a=e.match(/^\s*(\d+)\s*:\s*(\d+)\s*$/);return a?+a[2]+60*a[1]:t}function u(){let e=[+n.stars.from.value||0,+n.stars.to.value||1/0].sort((e,t)=>e-t),a=[+n.rating.from.value||0,+n.rating.to.value||100].sort((e,t)=>e-t),r=[s(n.duration.from.value,0),s(n.duration.to.value,1/0)].sort((e,t)=>e-t),i=t.filter(t=>{if(!n.difficulty[t.diff].checked)return!1;let o=60*t.duration/t.bpm;return l(t.stars,e[0],e[1])&&l(t.rating,a[0],a[1])&&l(o,r[0],r[1])}),[u,m]=n.sort.value.split("-");m="desc"===m?-1:1,i.sort((e,t)=>e[u]<t[u]?-m:e[u]>t[u]?m:0);let p=new Map;for(i.forEach(e=>{let t=p.get(e.id);t||(t=[],p.set(e.id,t)),t.push(e)});o.list.firstChild;)o.list.removeChild(o.list.firstChild);d=[...p.values()].map((e,t)=>{let a=e[0],n=document.createElement("div"),r=t+1+". "+a.artist+" - "+a.name+" | "+a.mapper,i=[a.rating&&"👍 "+a.rating.toFixed(2)+"%",e.map(e=>e.diff.replace("ExpertPlus","Expert+")).join(", ")].filter(e=>e).join(" - ");return i&&(r+=" ("+i+")"),n.appendChild(document.createTextNode(r)),o.list.appendChild(n),{hash:a.id,songName:a.name}});let h=i.length,f=d.length;o.count.textContent=h+" leaderboard"+(1===h?"":"s")+" from "+f+" map"+(1===f?"":"s"),c()}function c(){let t=e.transparent,o=a(".image-options input:checked");o&&(t=o.value);let r={playlistTitle:n.name.value||n.name.placeholder,playlistAuthor:n.author.value||n.author.placeholder,image:t,songs:d.slice(0,+n.count.value||1/0)};a(".download").href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r))}[n.stars.from,n.stars.to,n.rating.from,n.rating.to,n.duration.from,n.duration.to,n.sort].forEach(e=>e.addEventListener("input",u)),[n.name,n.author,n.count].forEach(e=>e.addEventListener("input",c)),u(),document.body.classList.add("loaded")})();
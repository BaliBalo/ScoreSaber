(async()=>{document.body.addEventListener("mousedown",()=>{document.body.classList.add("mouse")}),document.body.addEventListener("keydown",()=>{document.body.classList.remove("mouse")});const e={transparent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",scoresaber:"/client/scoresaber.png",peepoUK:"/client/icon.png"};let t=(await fetch("/ranked").then(e=>e.json())).list,a={Easy:"Ez",Normal:"N",Hard:"H",Expert:"Ex",ExpertPlus:"Ex+"},n=document.querySelector.bind(document),o={difficulty:{},stars:{from:n(".stars .from input"),to:n(".stars .to input")},rating:{from:n(".rating .from input"),to:n(".rating .to input")},duration:{from:n(".duration .from input"),to:n(".duration .to input")},name:n(".name"),author:n(".author"),count:n(".count"),sort:n(".sort")},r={count:n(".result-count"),list:n(".preview .list")},i=n(".difficulties");[{name:"Easy"},{name:"Normal"},{name:"Hard"},{name:"Expert"},{name:"ExpertPlus",label:"Expert+"}].forEach(e=>{let t=document.createElement("label"),a=document.createElement("input"),n=document.createElement("span");a.type="checkbox",a.checked="true",a.addEventListener("change",c),t.appendChild(a),n.appendChild(document.createTextNode(e.label||e.name)),t.appendChild(n),o.difficulty[e.name]=a,i.appendChild(t)});let d=n(".image-options");Object.keys(e).forEach(async(t,a)=>{let n=e[t],o=document.createElement("label"),r=document.createElement("input"),i=document.createElement("img");o.className=t,r.type="radio",r.name="image",r.checked=!a,i.crossOrigin="anonymous",await new Promise((e,t)=>{i.onload=e,i.onerror=t,i.src=n});let s=document.createElement("canvas"),l=s.getContext("2d");s.height=i.naturalHeight,s.width=i.naturalWidth,l.drawImage(i,0,0),r.value=s.toDataURL("image/png"),r.addEventListener("change",m),o.appendChild(r),o.appendChild(i),d.appendChild(o)});let s=[];function l(e,t,a){return!(e<t||e>a)}function u(e,t){if(!e)return t;if(+e)return+e;let a=e.match(/^\s*(\d+)\s*:\s*(\d+)\s*$/);return a?+a[2]+60*a[1]:t}function c(){let e=[+o.stars.from.value||0,+o.stars.to.value||1/0].sort((e,t)=>e-t),n=[+o.rating.from.value||0,+o.rating.to.value||100].sort((e,t)=>e-t),i=[u(o.duration.from.value,0),u(o.duration.to.value,1/0)].sort((e,t)=>e-t),d=t.filter(t=>{if(!o.difficulty[t.diff].checked)return!1;let a=60*t.duration/t.bpm;return l(t.stars,e[0],e[1])&&l(t.rating,n[0],n[1])&&l(a,i[0],i[1])}),[c,p]=o.sort.value.split("-");p="desc"===p?-1:1,d.sort((e,t)=>e[c]<t[c]?-p:e[c]>t[c]?p:0);let f=new Map;for(d.forEach(e=>{let t=f.get(e.id);t||(t=[],f.set(e.id,t)),t.push(e)});r.list.firstChild;)r.list.removeChild(r.list.firstChild);s=[...f.values()].map((e,t)=>{let n=e[0],o=document.createElement("div");o.className="item",o.title=["downloads: "+n.downloads,"upvotes: "+n.upvotes,"downvotes: "+n.downvotes].join("\n");let i=t+1+". "+n.artist+" - "+n.name+" | "+n.mapper,d=[n.rating&&"👍 "+n.rating.toFixed(2)+"%",e.map(e=>a[e.diff]||e.diff).join(", ")].filter(e=>e).join(" - ");return d&&(i+=" ("+d+")"),o.appendChild(document.createTextNode(i)),r.list.appendChild(o),{hash:n.id,songName:n.name}});let h=d.length,g=s.length;r.count.textContent=h+" leaderboard"+(1===h?"":"s")+" from "+g+" map"+(1===g?"":"s"),m()}function m(){let t=e.transparent,a=n(".image-options input:checked");a&&(t=a.value);let r={playlistTitle:o.name.value||o.name.placeholder,playlistAuthor:o.author.value||o.author.placeholder,image:t,songs:s.slice(0,+o.count.value||1/0)};n(".download").href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r))}[o.stars.from,o.stars.to,o.rating.from,o.rating.to,o.duration.from,o.duration.to,o.sort].forEach(e=>e.addEventListener("input",c)),[o.name,o.author,o.count].forEach(e=>e.addEventListener("input",m)),c(),document.body.classList.add("loaded")})();
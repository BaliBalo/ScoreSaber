(async()=>{document.body.addEventListener("mousedown",(()=>{document.body.classList.add("mouse")})),document.body.addEventListener("keydown",(()=>{document.body.classList.remove("mouse")}));const e={transparent:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",scoresaber:"/client/scoresaber.png",peepoUK:"/client/icon.png"};let t=(await fetch("/ranked").then((e=>e.json()))).list,n={ExpertPlus:"Expert+"},a=document.querySelector.bind(document),o={difficulty:{},stars:{from:a(".stars .from input"),to:a(".stars .to input")},rating:{from:a(".rating .from input"),to:a(".rating .to input")},duration:{from:a(".duration .from input"),to:a(".duration .to input")},name:a(".name"),author:a(".author"),count:a(".count"),sort:a(".sort")},r={count:a(".result-count"),list:a(".preview .list")},i=a(".difficulties");[{name:"Easy"},{name:"Normal"},{name:"Hard"},{name:"Expert"},{name:"ExpertPlus",label:"Expert+"}].forEach((e=>{let t=document.createElement("label"),n=document.createElement("input"),a=document.createElement("span");n.type="checkbox",n.checked="true",n.addEventListener("change",c),t.appendChild(n),a.appendChild(document.createTextNode(e.label||e.name)),t.appendChild(a),o.difficulty[e.name]=n,i.appendChild(t)}));let d=a(".image-options");Object.keys(e).forEach((async(t,n)=>{let a=e[t],o=document.createElement("label"),r=document.createElement("input"),i=document.createElement("img");o.className=t,r.type="radio",r.name="image",r.checked=!n,i.crossOrigin="anonymous",await new Promise(((e,t)=>{i.onload=e,i.onerror=t,i.src=a}));let s=document.createElement("canvas"),l=s.getContext("2d");s.height=i.naturalHeight,s.width=i.naturalWidth,l.drawImage(i,0,0),r.value=s.toDataURL("image/png"),r.addEventListener("change",m),o.appendChild(r),o.appendChild(i),d.appendChild(o)}));let s=[];function l(e,t,n){return!(e<t||e>n)}function u(e,t){if(!e)return t;if(+e)return+e;let n=e.match(/^\s*(\d+)\s*:\s*(\d+)\s*$/);return n?+n[2]+60*n[1]:t}function c(){let e=[+o.stars.from.value||0,+o.stars.to.value||1/0].sort(((e,t)=>e-t)),a=[+o.rating.from.value||0,+o.rating.to.value||100].sort(((e,t)=>e-t)),i=[u(o.duration.from.value,0),u(o.duration.to.value,1/0)].sort(((e,t)=>e-t)),d=t.filter((t=>{if(!o.difficulty[t.diff].checked)return!1;let n=t.durationSeconds||60*t.duration/t.bpm;return l(t.stars,e[0],e[1])&&l(t.rating,a[0],a[1])&&l(n,i[0],i[1])})),[c,p]=o.sort.value.split("-");for(p="desc"===p?-1:1,d.sort(((e,t)=>e[c]<t[c]?-p:e[c]>t[c]?p:0));r.list.firstChild;)r.list.removeChild(r.list.firstChild);s=d.map(((e,t)=>{let a=document.createElement("div");a.className="item",a.title=["downloads: "+e.downloads,"upvotes: "+e.upvotes,"downvotes: "+e.downvotes].join("\n");let o=t+1+". "+e.artist+" - "+e.name+" | "+e.mapper,i=[e.rating&&"👍 "+e.rating.toFixed(2)+"%",n[e.diff]||e.diff].filter((e=>e)).join(" - ");return i&&(o+=" ("+i+")"),a.appendChild(document.createTextNode(o)),r.list.appendChild(a),{hash:e.id,songName:e.name,difficulties:[{characteristic:"Standard",name:e.diff}]}}));let f=d.length,h=s.length;r.count.textContent=f+" leaderboard"+(1===f?"":"s")+" from "+h+" map"+(1===h?"":"s"),m()}function m(){let t=e.transparent,n=a(".image-options input:checked");n&&(t=n.value);let r={playlistTitle:o.name.value||o.name.placeholder,playlistAuthor:o.author.value||o.author.placeholder,image:t,songs:s.slice(0,+o.count.value||1/0)};a(".download").href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r))}[o.stars.from,o.stars.to,o.rating.from,o.rating.to,o.duration.from,o.duration.to,o.sort].forEach((e=>e.addEventListener("input",c))),[o.name,o.author,o.count].forEach((e=>e.addEventListener("input",m))),c(),document.body.classList.add("loaded")})();